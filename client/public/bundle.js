!function(t){var e={};function s(a){if(e[a])return e[a].exports;var r=e[a]={i:a,l:!1,exports:{}};return t[a].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=t,s.c=e,s.d=function(t,e,a){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)s.d(a,r,function(e){return t[e]}.bind(null,r));return a},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/public",s(s.s=3)}([function(t,e,s){"use strict";var a=s(1);s.d(e,"GridConfig",(function(){return a.a}));s(2)},function(t,e,s){"use strict";s.d(e,"a",(function(){return a}));class a{constructor(t){this.width=0,this.height=0,this.rows=0,this.columns=0,Object.assign(this,t)}get cellWidth(){return this.width/this.rows}get cellHeight(){return this.height/this.columns}}},function(t,e){},function(t,e,s){"use strict";s.r(e);class a{constructor(t){this.config=t;const e=document.getElementById("draw");e.onmousemove=this.mouseMove.bind(this),e.onmousedown=this.mouseClick.bind(this),e.onmouseup=this.mouseClick.bind(this),e.ontouchmove=this.mouseMove.bind(this),e.ontouchstart=this.mouseClick.bind(this),e.ontouchend=this.mouseClick.bind(this),e.oncontextmenu=()=>!1,this.ctx=e.getContext("2d"),this.ctx.canvas.width=t.width,this.ctx.canvas.height=t.height,this.drawing=!1,this.erasing=!1,this.drawGrid(),this.drawingMatrix=this.getInitDrawingMatrix()}mouseMove(t){t=t||window.event;let e=this.getOffset(t);(this.drawing||this.erasing)&&this.draw(e.x,e.y)}mouseClick(t){t=t||window.event;let e=this.getOffset(t);"mousedown"===t.type||"touchstart"===t.type||"touchmove"===t.type?("mousedown"===t.type?0==t.button?(this.drawing=!0,this.erasing=!1):2==t.button&&(this.erasing=!0,this.drawing=!1):(this.drawing=!0,this.erasing=!1),this.draw(e.x,e.y)):(this.drawing=!1,this.erasing=!1)}getOffset(t){let e=0,s=0;t instanceof TouchEvent?t.touches.length>0&&(e=t.touches[0].clientX,s=t.touches[0].clientY):(e=t.clientX,s=t.clientY);const a=(t.target||t.srcElement).getBoundingClientRect();return{x:0|e-a.left,y:0|s-a.top}}draw(t,e){t=Math.floor(t/this.config.cellWidth),e=Math.floor(e/this.config.cellHeight);let s="black",a=1;this.erasing&&(s="white",a=0),this.ctx.beginPath(),this.ctx.rect(t*this.config.cellWidth,e*this.config.cellHeight,this.config.cellWidth,this.config.cellHeight),this.ctx.fillStyle=s,this.ctx.fill(),this.ctx.stroke(),this.drawingMatrix[e][t]=a}drawGrid(){for(let t=0;t<this.config.rows;t++)for(let e=0;e<this.config.columns;e++)this.ctx.beginPath(),this.ctx.rect(t*this.config.cellWidth,e*this.config.cellHeight,this.config.cellWidth,this.config.cellHeight),this.ctx.stroke()}reset(){this.drawingMatrix.length=0,this.ctx.clearRect(0,0,this.config.width,this.config.height),this.drawGrid(),this.drawingMatrix=this.getInitDrawingMatrix()}getInitDrawingMatrix(){let t=[];for(let e=0;e<this.config.rows;e++){t.push([]);for(let s=0;s<this.config.columns;s++)t[e][s]=0}return t}}var r,i=s(0);class l{constructor(t){this.game=t;const e=document.getElementById("background-layer");this.ctx=e.getContext("2d"),this.ctx.shadowOffsetX=0,this.ctx.shadowOffsetY=0,this.ctx.shadowBlur=0,this.ctx.shadowColor="",this.ctx.canvas.width=this.game.gridConfig.width,this.ctx.canvas.height=this.game.gridConfig.height}clear(){this.ctx.clearRect(0,0,this.game.gridConfig.width,this.game.gridConfig.height)}}class n{constructor(t){this.game=t;const e=document.getElementById("solid-layer");this.ctx=e.getContext("2d"),this.ctx.shadowOffsetX=0,this.ctx.shadowOffsetY=0,this.ctx.shadowBlur=0,this.ctx.shadowColor="",this.ctx.canvas.width=this.game.gridConfig.width,this.ctx.canvas.height=this.game.gridConfig.height}clear(){this.ctx.clearRect(0,0,this.game.gridConfig.width,this.game.gridConfig.height)}}!function(t){t.Black="#000000",t.DarkBlue="#1D2B53",t.DarkPurple="#7E2553",t.DarkGreen="#008751",t.Brown="#AB5236",t.DarkGrey="#5F574F",t.LightGrey="#C2C3C7",t.White="#FFF1E8",t.Red="#FF004D",t.Orange="#FFA300",t.Yellow="#FFEC27",t.Green="#00E436",t.Blue="#29ADFF",t.Lavender="#83769C",t.Pink="#FF77A8",t.LightPeach="#FFCCAA"}(r||(r={}));const h=[r.Black,r.DarkBlue,r.DarkGrey,r.DarkPurple,r.Yellow,r.Red];var o,c,G,g,d,m;!function(t){t[t.Up=1]="Up",t[t.Down=2]="Down",t[t.Left=3]="Left",t[t.Right=4]="Right"}(o||(o={})),function(t){t[t.Login=1]="Login",t[t.Move=2]="Move",t[t.Ping=3]="Ping",t[t.Pong=4]="Pong",t[t.Error=5]="Error",t[t.NpcMove=6]="NpcMove",t[t.NpcsInRoom=7]="NpcsInRoom",t[t.Pve=8]="Pve",t[t.ItemsInRoom=9]="ItemsInRoom",t[t.ItemPick=10]="ItemPick",t[t.ItemDrop=11]="ItemDrop",t[t.ItemUse=12]="ItemUse",t[t.ItemWear=13]="ItemWear",t[t.ItemRemove=14]="ItemRemove",t[t.ItemDroped=15]="ItemDroped",t[t.Stats=16]="Stats",t[t.Message=17]="Message",t[t.Dialog=18]="Dialog",t[t.Rank=19]="Rank"}(c||(c={})),function(t){t[t.Initial=0]="Initial",t[t.Woods=1]="Woods"}(G||(G={})),function(t){t[t.Player=0]="Player",t[t.Npc=1]="Npc"}(g||(g={})),function(t){t[t.Empty=0]="Empty",t[t.Coffee=1]="Coffee",t[t.Coin=2]="Coin",t[t.BronzeDagger=3]="BronzeDagger"}(d||(d={})),function(t){t[t.None=0]="None",t[t.Head=1]="Head",t[t.Torso=2]="Torso",t[t.Legs=3]="Legs",t[t.Weapon=4]="Weapon"}(m||(m={}));class y{constructor(t,e,s){this.game=t,this.layer=s,this.x=e.x,this.y=e.y,this.color=e.color,this.name=e.name,this.id=e.id,this.currentRoomId=e.currentRoomId,this.hp=e.hp,this.maxHp=e.maxHp,this.pveData=e.pveData,this.isFighting=!1,this.playerSize=8,this.matrix=[...e.matrix]}draw(){this.layer.ctx.beginPath(),this.layer.ctx.fillStyle=this.color;for(let t=0;t<this.playerSize;t++)for(let e=0;e<this.playerSize;e++){if(0!=this.matrix[e][t]){const s=t*this.game.gridConfig.cellWidth/this.playerSize+this.x*this.game.gridConfig.cellWidth|0,a=e*this.game.gridConfig.cellHeight/this.playerSize+this.y*this.game.gridConfig.cellHeight|0,r=this.game.gridConfig.cellWidth/this.playerSize,i=this.game.gridConfig.cellHeight/this.playerSize;this.layer.ctx.fillRect(s,a,r,i)}}this.layer.ctx.fill()}takeDamage(t){this.pveData=t,this.hp=t.playerHp,this.isFighting=!0,this.drawHp(),this.hp<=0&&(this.hp=this.maxHp,this.isFighting=!1)}drawHp(){this.layer.ctx.beginPath(),this.layer.ctx.fillStyle=r.Red,this.layer.ctx.fillRect(this.x*this.game.gridConfig.cellWidth,this.y*this.game.gridConfig.cellHeight-7,this.game.gridConfig.cellWidth,5),this.layer.ctx.fillStyle=r.DarkGreen,this.layer.ctx.fillRect(this.x*this.game.gridConfig.cellWidth,this.y*this.game.gridConfig.cellHeight-7,this.game.gridConfig.cellWidth*this.hp/this.maxHp,5),this.layer.ctx.fill(),this.drawHit()}drawHit(){let t="";this.layer.ctx.font="15px arial",this.layer.ctx.textAlign="center",0==this.pveData.damageCaused?this.layer.ctx.fillStyle=r.Blue:(this.layer.ctx.fillStyle=r.Red,t="-");const e=this.x*this.game.gridConfig.cellWidth+this.game.gridConfig.cellWidth/2,s=this.y*this.game.gridConfig.cellHeight-10;this.layer.ctx.fillText(`${t}${this.pveData.damageCaused}`,e,s)}move(t,e,s){t==this.x&&e==this.y||(this.isFighting=!1),this.x=t,this.y=e,this.currentRoomId=s}isValidMove(t,e){let s=!0;switch(t){case o.Up:this.isOnBorder(e,+this.x,+this.y-1)||e[+this.y-1][+this.x]&&(s=!1);break;case o.Down:this.isOnBorder(e,+this.x,+this.y+1)||e[+this.y+1][+this.x]&&(s=!1);break;case o.Left:this.isOnBorder(e,+this.x-1,+this.y)||e[+this.y][+this.x-1]&&(s=!1);break;case o.Right:this.isOnBorder(e,+this.x+1,+this.y)||e[+this.y][+this.x+1]&&(s=!1)}return s}isOnBorder(t,e,s){let a=!1;return void 0!==t[s]?void 0===t[s][e]&&(a=!0):a=!0,a}}class p{constructor(t,e,s,a){this.game=t,this.layer=e,this.id=s.id,this.roomId=s.roomId,this.x=s.x,this.y=s.y,this.tileSize=8,this.tileMatrix=[...a],this.maxHp=s.maxHp,this.hp=s.hp,this.isFighting=!1}draw(){this.layer.ctx.beginPath();for(let t=0;t<this.tileSize;t++)for(let e=0;e<this.tileSize;e++){const s=this.tileMatrix[e][t];if(0!==s){this.layer.ctx.fillStyle=s;const a=t*this.game.gridConfig.cellWidth/this.tileSize+this.x*this.game.gridConfig.cellWidth|0,r=e*this.game.gridConfig.cellHeight/this.tileSize+this.y*this.game.gridConfig.cellHeight|0,i=this.game.gridConfig.cellWidth/this.tileSize,l=this.game.gridConfig.cellHeight/this.tileSize;this.layer.ctx.fillRect(a,r,i,l)}}this.layer.ctx.fill()}takeDamage(t){this.pveData=t,this.hp=t.npcHp,this.isFighting=!0,this.drawHp(),this.hp<=0&&(this.hp=this.maxHp,this.isFighting=!1)}drawHp(){this.layer.ctx.beginPath(),this.layer.ctx.fillStyle=r.Red,this.layer.ctx.fillRect(this.x*this.game.gridConfig.cellWidth,this.y*this.game.gridConfig.cellHeight-7,this.game.gridConfig.cellWidth,5),this.layer.ctx.fillStyle=r.DarkGreen,this.layer.ctx.fillRect(this.x*this.game.gridConfig.cellWidth,this.y*this.game.gridConfig.cellHeight-7,this.game.gridConfig.cellWidth*this.hp/this.maxHp,5),this.layer.ctx.fill(),this.drawHit()}drawHit(){let t="";this.layer.ctx.font="15px arial",this.layer.ctx.textAlign="center",0==this.pveData.damageCaused?this.layer.ctx.fillStyle=r.Blue:(this.layer.ctx.fillStyle=r.Red,t="-"),this.layer.ctx.fillText(`${t}${this.pveData.damageCaused}`,this.x*this.game.gridConfig.cellWidth+this.game.gridConfig.cellWidth/2,this.y*this.game.gridConfig.cellHeight-10)}move(t){t.x==this.x&&t.y==this.y||(this.isFighting=!1),this.x=t.x,this.y=t.y}clear(){this.layer.ctx.clearRect(this.x*this.game.gridConfig.cellWidth,this.y*this.game.gridConfig.cellHeight,this.game.gridConfig.cellWidth,this.game.gridConfig.cellHeight)}destroy(){this.clear(),this.layer=null,this.id=0,this.x=0,this.y=0}}const F={Dog:[[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[r.Brown,0,0,0,0,r.Brown,0,r.Brown],[r.Brown,0,0,0,0,r.Brown,r.Brown,r.Brown],[0,r.Brown,r.Brown,r.Brown,r.Brown,r.Brown,r.Brown,r.Brown],[0,r.Brown,r.Brown,r.Brown,r.Brown,r.Brown,0,0],[0,r.Brown,0,0,0,r.Brown,0,0],[0,r.Brown,0,0,0,r.Brown,0,0]],Spider:[[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,r.DarkGrey,r.DarkGrey,r.DarkGrey,r.DarkGrey,0,0],[0,r.DarkGrey,r.DarkGrey,r.DarkGrey,r.DarkGrey,r.DarkGrey,r.DarkGrey,0],[0,r.DarkGrey,r.DarkPurple,r.DarkGrey,r.DarkGrey,r.DarkPurple,r.DarkGrey,0],[r.DarkGrey,r.DarkGrey,r.DarkGrey,r.DarkGrey,r.DarkGrey,r.DarkGrey,r.DarkGrey,r.DarkGrey],[r.DarkGrey,0,r.DarkGrey,0,0,r.DarkGrey,0,r.DarkGrey],[r.DarkGrey,0,r.DarkGrey,0,0,r.DarkGrey,0,r.DarkGrey]]};class u{constructor(t,e,s,a){this.game=t,this.layer=e,this.id=s.id,this.itemId=s.itemId,this.roomId=s.roomId,this.x=s.x,this.y=s.y,this.tileSize=8,this.itemMatrix=[...a]}draw(){this.layer.ctx.beginPath();for(let t=0;t<this.tileSize;t++)for(let e=0;e<this.tileSize;e++){const s=this.itemMatrix[e][t];if(0!==s){this.layer.ctx.fillStyle=s;const a=t*this.game.gridConfig.cellWidth/this.tileSize+this.x*this.game.gridConfig.cellWidth|0,r=e*this.game.gridConfig.cellHeight/this.tileSize+this.y*this.game.gridConfig.cellHeight|0,i=this.game.gridConfig.cellWidth/this.tileSize,l=this.game.gridConfig.cellHeight/this.tileSize;this.layer.ctx.fillRect(a,r,i,l)}}this.layer.ctx.fill()}clear(){this.layer.ctx.clearRect(this.x*this.game.gridConfig.cellWidth,this.y*this.game.gridConfig.cellHeight,this.game.gridConfig.cellWidth,this.game.gridConfig.cellHeight)}destroy(){this.clear(),this.layer=null,this.id=0,this.x=0,this.y=0}}const w={Empty:[[r.LightGrey,r.LightGrey,r.LightGrey,r.LightGrey,r.LightGrey,r.LightGrey,r.LightGrey,r.LightGrey],[r.LightGrey,0,0,0,0,0,0,r.LightGrey],[r.LightGrey,0,0,0,0,0,0,r.LightGrey],[r.LightGrey,0,0,0,0,0,0,r.LightGrey],[r.LightGrey,0,0,0,0,0,0,r.LightGrey],[r.LightGrey,0,0,0,0,0,0,r.LightGrey],[r.LightGrey,0,0,0,0,0,0,r.LightGrey],[r.LightGrey,r.LightGrey,r.LightGrey,r.LightGrey,r.LightGrey,r.LightGrey,r.LightGrey,r.LightGrey]],Coffee:[[0,0,0,0,r.LightGrey,r.LightGrey,r.LightGrey,0],[0,0,0,0,r.LightGrey,r.LightGrey,0,0],[0,0,0,r.LightGrey,r.LightGrey,0,0,0],[0,0,r.DarkGrey,r.DarkGrey,r.DarkGrey,r.DarkGrey,r.DarkGrey,r.DarkGrey],[0,0,r.DarkGrey,r.DarkGrey,r.DarkGrey,r.DarkGrey,0,r.DarkGrey],[0,0,r.DarkGrey,r.DarkGrey,r.DarkGrey,r.DarkGrey,0,r.DarkGrey],[0,0,r.DarkGrey,r.DarkGrey,r.DarkGrey,r.DarkGrey,r.DarkGrey,r.DarkGrey],[0,0,r.DarkGrey,r.DarkGrey,r.DarkGrey,r.DarkGrey,0,0]],Coin:[[0,0,0,r.Yellow,r.Yellow,0,0,0],[0,0,r.Yellow,r.Orange,r.Yellow,r.Yellow,0,0],[0,r.Yellow,r.Orange,r.Yellow,r.Yellow,r.Yellow,r.Yellow,0],[0,r.Yellow,r.Orange,r.Yellow,r.Yellow,r.Yellow,r.Yellow,0],[0,r.Yellow,r.Orange,r.Yellow,r.Yellow,r.Yellow,r.Yellow,0],[0,r.Yellow,r.Orange,r.Yellow,r.Yellow,r.Yellow,r.Yellow,0],[0,0,r.Yellow,r.Orange,r.Yellow,r.Yellow,0,0],[0,0,0,r.Yellow,r.Yellow,0,0,0]],BronzeDagger:[[0,0,0,0,0,0,0,0],[0,0,0,0,r.Brown,0,0,0],[0,0,0,r.Brown,r.Brown,0,0,0],[0,0,0,r.Brown,r.Brown,0,0,0],[0,0,0,r.Brown,r.Brown,0,0,0],[0,0,0,r.Brown,r.Brown,0,0,0],[0,0,r.DarkGrey,r.DarkGrey,r.DarkGrey,r.DarkGrey,0,0],[0,0,0,r.Brown,r.Brown,0,0,0]]};class f{constructor(t){this.game=t,this.playerListElement=document.getElementById("player-list");const e=document.getElementById("sprites-layer");this.ctx=e.getContext("2d"),this.ctx.shadowOffsetX=0,this.ctx.shadowOffsetY=0,this.ctx.shadowBlur=0,this.ctx.shadowColor="",this.ctx.canvas.width=this.game.gridConfig.width,this.ctx.canvas.height=this.game.gridConfig.height,this.players=[],this.npcs=[],this.items=[]}draw(t){this.ctx.clearRect(0,0,this.game.gridConfig.width,this.game.gridConfig.height),this.drawItems(t),this.drawPlayers(t),this.drawNpcs(t)}clear(){this.ctx.clearRect(0,0,this.game.gridConfig.width,this.game.gridConfig.height)}addPlayers(t){this.players.splice(0,this.players.length);for(const e of t)this.players.push(new y(this.game,e,this))}addNpcs(t){this.npcs.splice(0,this.npcs.length);for(const e of t)this.npcs.push(new p(this.game,this,e,this.getMatrixNpcById(e.npcId)))}addItems(t){this.items.splice(0,this.items.length);for(const e of t)this.items.push(new u(this.game,this,e,this.getMatrixItemById(e.itemId)))}addItem(t){this.items.push(new u(this.game,this,t,this.getMatrixItemById(t.itemId)))}removeItem(t){const e=this.items.findIndex(e=>e.x==t.x&&e.y==t.y);e>-1&&this.items.splice(e,1)}drawPlayers(t){for(;this.playerListElement.firstChild;)this.playerListElement.removeChild(this.playerListElement.firstChild);this.players.forEach(e=>{const s=document.createElement("li");s.appendChild(document.createTextNode(e.name)),s.style.color=e.color,this.playerListElement.appendChild(s),e.currentRoomId==t&&(e.draw(),e.isFighting&&e.drawHp())})}drawNpcs(t){this.npcs.forEach(e=>{e.roomId==t&&(e.draw(),e.isFighting&&e.drawHp())})}drawItems(t){this.items.forEach(e=>{e.roomId==t&&e.draw()})}getPlayerById(t){return this.players.find(e=>e.id===t)}getNpcByIdAndRoom(t,e){return this.npcs.find(s=>s.id===+t&&s.roomId===+e)}getMatrixNpcById(t){let e=F[Object.keys(F)[t-1]];return e||console.log("No sprite defined"),e}getMatrixItemById(t){let e=d[t];return w[e]}}const k={Tree:[[0,r.DarkGreen,r.DarkGreen,r.DarkGreen,r.DarkGreen,r.DarkGreen,r.DarkGreen,0],[r.DarkGreen,r.DarkGreen,r.DarkGreen,r.DarkGreen,r.DarkGreen,r.DarkGreen,r.DarkGreen,r.DarkGreen],[r.DarkGreen,r.DarkGreen,r.DarkGreen,r.DarkGreen,r.DarkGreen,r.DarkGreen,r.DarkGreen,r.DarkGreen],[r.DarkGreen,r.DarkGreen,r.DarkGreen,r.DarkGreen,r.DarkGreen,r.DarkGreen,r.DarkGreen,r.DarkGreen],[0,r.DarkGreen,r.DarkGreen,r.DarkGreen,r.DarkGreen,r.DarkGreen,r.DarkGreen,0],[0,0,0,r.Brown,r.Brown,0,0,0],[0,0,0,r.Brown,r.Brown,0,0,0],[0,0,0,r.Brown,r.Brown,0,0,0]],SmallTree:[[0,0,r.DarkGreen,r.DarkGreen,r.DarkGreen,r.DarkGreen,0,0],[0,r.DarkGreen,r.DarkGreen,r.DarkGreen,r.DarkGreen,r.DarkGreen,r.DarkGreen,0],[0,r.DarkGreen,r.DarkGreen,r.DarkGreen,r.DarkGreen,r.DarkGreen,r.DarkGreen,0],[0,r.DarkGreen,r.DarkGreen,r.DarkGreen,r.DarkGreen,r.DarkGreen,r.DarkGreen,0],[0,0,r.DarkGreen,r.DarkGreen,r.DarkGreen,r.DarkGreen,0,0],[0,0,0,r.Brown,r.Brown,0,0,0],[0,0,0,r.Brown,r.Brown,0,0,0],[0,0,0,r.Brown,r.Brown,0,0,0]],FlatGrass:[[r.Green,r.Green,r.Green,r.Green,r.Green,r.Green,r.Green,r.Green],[r.Green,r.Green,r.Green,r.Green,r.Green,r.Green,r.Green,r.Green],[r.Green,r.Green,r.Green,r.Green,r.Green,r.Green,r.Green,r.Green],[r.Green,r.Green,r.Green,r.Green,r.Green,r.Green,r.Green,r.Green],[r.Green,r.Green,r.Green,r.Green,r.Green,r.Green,r.Green,r.Green],[r.Green,r.Green,r.Green,r.Green,r.Green,r.Green,r.Green,r.Green],[r.Green,r.Green,r.Green,r.Green,r.Green,r.Green,r.Green,r.Green],[r.Green,r.Green,r.Green,r.Green,r.Green,r.Green,r.Green,r.Green]],Grass:[[r.Green,r.Green,r.Green,r.Green,r.Green,r.Green,r.Green,r.Green],[r.Green,r.Green,r.Green,r.Green,r.Green,r.DarkGreen,r.Green,r.Green],[r.Green,r.Green,r.DarkGreen,r.Green,r.Green,r.Green,r.Green,r.Green],[r.Green,r.Green,r.Green,r.Green,r.Green,r.Green,r.Green,r.Green],[r.Green,r.DarkGreen,r.Green,r.Green,r.Green,r.Green,r.Green,r.Green],[r.Green,r.Green,r.Green,r.Green,r.DarkGreen,r.Green,r.Green,r.Green],[r.Green,r.Green,r.Green,r.Green,r.Green,r.Green,r.Green,r.Green],[r.Green,r.Green,r.Green,r.Green,r.Green,r.Green,r.Green,r.Green]],Bush:[[r.Green,r.Green,r.Green,r.Green,r.Green,r.Green,r.Green,r.Green],[r.Green,r.Green,r.Green,r.Green,r.Green,r.Green,r.Green,r.Green],[r.Green,r.Green,r.Green,r.Green,r.Green,r.Green,r.Green,r.DarkGreen],[r.Green,r.Green,r.DarkGreen,r.Green,r.Green,r.Green,r.DarkGreen,r.Green],[r.Green,r.Green,r.Green,r.DarkGreen,r.Green,r.Green,r.DarkGreen,r.Green],[r.Green,r.Green,r.Green,r.DarkGreen,r.Green,r.DarkGreen,r.Green,r.Green],[r.Green,r.DarkGreen,r.Green,r.Green,r.DarkGreen,r.DarkGreen,r.Green,r.DarkGreen],[r.Green,r.Green,r.DarkGreen,r.Green,r.DarkGreen,r.DarkGreen,r.DarkGreen,r.Green]],Dirt:[[r.Green,r.Green,r.LightPeach,r.LightPeach,r.LightPeach,r.LightPeach,r.Green,r.Green],[r.Green,r.Green,r.LightPeach,r.LightPeach,r.LightPeach,r.LightPeach,r.LightPeach,r.LightPeach],[r.LightPeach,r.LightPeach,r.LightPeach,r.LightPeach,r.LightPeach,r.LightPeach,r.LightPeach,r.LightPeach],[r.LightPeach,r.LightPeach,r.LightPeach,r.LightPeach,r.LightPeach,r.LightPeach,r.LightPeach,r.LightPeach],[r.LightPeach,r.LightPeach,r.LightPeach,r.LightPeach,r.LightPeach,r.LightPeach,r.LightPeach,r.LightPeach],[r.LightPeach,r.LightPeach,r.LightPeach,r.LightPeach,r.LightPeach,r.LightPeach,r.LightPeach,r.LightPeach],[r.Green,r.LightPeach,r.LightPeach,r.LightPeach,r.LightPeach,r.LightPeach,r.LightPeach,r.Green],[r.Green,r.LightPeach,r.LightPeach,r.LightPeach,r.LightPeach,r.LightPeach,r.Green,r.Green]],Rocks:[[r.Green,r.Green,r.Green,r.Green,r.Green,r.Green,r.Green,r.Green],[r.Green,r.Green,r.Green,r.Green,r.Green,r.Green,r.Green,r.Green],[r.Green,r.Green,r.Green,r.Green,r.Green,r.DarkGrey,r.Green,r.Green],[r.Green,r.DarkGrey,r.Green,r.Green,r.Green,r.Green,r.Green,r.Green],[r.Green,r.Green,r.Green,r.Green,r.Green,r.Green,r.Green,r.Green],[r.Green,r.Green,r.DarkGrey,r.Green,r.Green,r.DarkGrey,r.Green,r.Green],[r.Green,r.Green,r.Green,r.Green,r.Green,r.Green,r.Green,r.Green],[r.Green,r.Green,r.Green,r.Green,r.Green,r.Green,r.Green,r.Green]]},x=[[0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,2,1,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,1,0,0,0,0,0,0,0,2,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,2],[0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,2,0,0,0,0,1,0,0,2,0],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1]],I=[[1,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0],[0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,0,0,0,0,0,0,2,0],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0],[0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0],[2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]];class D{constructor(t,e,s,a,r){this.game=t,this.layer=e,this.id=0,this.x=s,this.y=a,this.tileSize=8,this.tileMatrix=r}draw(){this.layer.ctx.beginPath();for(let t=0;t<this.tileSize;t++)for(let e=0;e<this.tileSize;e++){const s=this.tileMatrix[e][t];if(0!==s){this.layer.ctx.fillStyle=s;const a=t*this.game.gridConfig.cellWidth/this.tileSize+this.x*this.game.gridConfig.cellWidth|0,r=e*this.game.gridConfig.cellHeight/this.tileSize+this.y*this.game.gridConfig.cellHeight|0,i=this.game.gridConfig.cellWidth/this.tileSize,l=this.game.gridConfig.cellHeight/this.tileSize;this.layer.ctx.fillRect(a,r,i,l)}}this.layer.ctx.fill()}clear(){this.layer.ctx.clearRect(this.x,this.y,this.game.gridConfig.cellWidth,this.game.gridConfig.cellHeight)}destroy(){this.clear(),this.game=null,this.layer=null,this.id=0,this.x=0,this.y=0}}class E{constructor(t,e,s,a){this.game=t,this.id=e,this.backgroundLayerShape=s,this.solidLayerShape=a,this.tiles=[],this.initTiles()}initTiles(){for(let t=0;t<this.game.gridConfig.columns;t++)for(let e=0;e<this.game.gridConfig.rows;e++){const s=this.backgroundLayerShape[e][t];0!=s&&this.tiles.push(new D(this.game,this.game.backgroundLayer,t,e,s));const a=this.solidLayerShape[e][t];if(0!=a){const s=k[Object.keys(k)[a-1]];this.tiles.push(new D(this.game,this.game.solidLayer,t,e,s))}}}draw(){for(const t of this.tiles)t.draw()}clear(){this.game.backgroundLayer.clear(),this.game.solidLayer.clear()}}const L=[[k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Grass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass],[k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass],[k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Bush,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Grass],[k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Bush,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass],[k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass],[k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Grass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass],[k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Grass,k.FlatGrass,k.FlatGrass],[k.Dirt,k.Dirt,k.Dirt,k.Dirt,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Rocks,k.FlatGrass,k.FlatGrass,k.FlatGrass],[k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Dirt,k.Dirt,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Grass,k.Grass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass],[k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Dirt,k.Dirt,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass],[k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Dirt,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Grass,k.FlatGrass],[k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Dirt,k.Dirt,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass],[k.FlatGrass,k.FlatGrass,k.Grass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Dirt,k.Dirt,k.FlatGrass,k.FlatGrass,k.Grass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass],[k.Bush,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Bush,k.FlatGrass,k.FlatGrass,k.Dirt,k.FlatGrass,k.Grass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass],[k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Dirt,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass],[k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Bush,k.Dirt,k.Dirt,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass]];class B extends E{constructor(t,e){super(t,e,L,I)}}const S=[[k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass],[k.FlatGrass,k.Bush,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass],[k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Grass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Bush,k.FlatGrass,k.FlatGrass,k.Grass,k.FlatGrass],[k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Grass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass],[k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Grass,k.FlatGrass,k.FlatGrass,k.Grass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Bush,k.Rocks,k.FlatGrass,k.FlatGrass],[k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Grass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass],[k.FlatGrass,k.Grass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Grass,k.FlatGrass,k.FlatGrass],[k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Bush,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Dirt,k.Dirt],[k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Rocks,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Rocks,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass],[k.FlatGrass,k.FlatGrass,k.Grass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass],[k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Grass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Bush,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass],[k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass],[k.FlatGrass,k.FlatGrass,k.Bush,k.Grass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Grass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass],[k.FlatGrass,k.Bush,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass],[k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass],[k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass]];class C extends E{constructor(t,e){super(t,e,S,x)}}class b{constructor(t){this.game=t,this.rooms=this.buildMap()}getRoomById(t){return this.rooms.find(e=>e.id===t)||this.rooms[t]}buildMap(){return[new C(this.game,G.Initial),new B(this.game,G.Woods)]}}class v{constructor(t,e){this.game=t,this.layer=e}draw(){this.layer.clear(),this.layer.ctx.beginPath(),this.layer.ctx.rect(0,0,this.game.gridConfig.width,this.game.gridConfig.height),this.layer.ctx.stroke()}}class P{constructor(t,e){this.gridConfig=new i.GridConfig({width:t.width,height:t.height,rows:16,columns:16}),this.backgroundLayer=new l(this),this.solidLayer=new n(this),this.spritesLayer=new f(this),this.map=new b(this),this.board=new v(this,this.backgroundLayer),e.isMobile()&&(e.mobileControls.style.display="block")}applyServerRules(t){this.gridConfig.rows=t.boardRows,this.gridConfig.columns=t.boardColumns,this.board.draw(),this.map.rooms[G.Initial].draw()}}class R{constructor(t){const e=this.parseString(t);this.playerId=e[1],this.serverRules={boardRows:+e[2],boardColumns:+e[3]},this.players=JSON.parse(e[4])}parseString(t){let e=t,s="";e=t.substr(0,t.indexOf(",[")),s=t.substr(t.indexOf("["),t.length);let a=e.split(",");return a.push(s),a}}class M{constructor(t){const e=this.parseString(t);this.playerId=e[1],this.currentRoomId=+e[4],this.x=+e[2],this.y=+e[3]}parseString(t){return t.split(",")}}class H{constructor(t){const e=this.parseString(t);this.id=+e[1],this.npcId=+e[2],this.x=+e[3],this.y=+e[4],this.roomId=+e[5]}parseString(t){return t.split(",")}}class W{constructor(t){const e=this.parseString(t);this.npcs=JSON.parse(e[1])}parseString(t){let e=t,s="";e=t.substr(0,t.indexOf(",[")),s=t.substr(t.indexOf("["),t.length);let a=e.split(",");return a.push(s),a}}class N{constructor(t){const e=this.parseString(t);this.attacker=e[1],this.damageCaused=+e[2],this.npcHp=+e[3],this.npcId=e[4],this.playerHp=+e[5],this.playerId=e[6],this.roomId=e[7]}parseString(t){return t.split(",")}}class z{constructor(t){const e=this.parseString(t);this.message=e[1]}parseString(t){return t.split(",")}}class T{constructor(t){const e=this.parseString(t);this.playerId=e[1],this.itemId=+e[2],this.coins=+e[3],this.x=+e[4],this.y=+e[5]}parseString(t){return t.split(",")}}class O{constructor(t){const e=this.parseString(t);this.id=+e[1],this.itemId=+e[2],this.roomId=+e[3],this.x=+e[4],this.y=+e[5]}parseString(t){return t.split(",")}}class Y{constructor(t){this.items=this.parseString(t)}parseString(t){let e=[],s="",a=+t.substr(0,t.indexOf(",[")).split(",")[1];s=t.substr(t.indexOf("["),t.length);let r=JSON.parse(s);for(const t of r)e.push(new $(t.id,t.itemId,a,t.x,t.y));return e}}class ${constructor(t,e,s,a,r){this.id=t,this.itemId=e,this.roomId=s,this.x=a,this.y=r}}class A{constructor(t){const e=this.parseString(t);this.itemId=e}parseString(t){return+t.split(",")[1]}}class U{constructor(t){const e=this.parseString(t);this.itemId=+e[1],this.gearType=+e[2]}parseString(t){return t.split(",")}}class j{constructor(t){const e=this.parseString(t);this.itemId=+e[1]}parseString(t){return t.split(",")}}class X{constructor(t){const e=this.parseString(t);this.itemId=+e[1]}parseString(t){return t.split(",")}}class K{constructor(t){const e=this.parseString(t);this.hp=+e[1],this.maxHp=+e[2],this.attack=+e[3],this.defense=+e[4],this.level=+e[5],this.xp=+e[6],this.xpNeeded=+e[7]}parseString(t){return t.split(",")}}class V{constructor(t){const e=this.parseString(t);this.message=e}parseString(t){const e=t.indexOf(',"')+2,s=t.split(',"')[1].indexOf('"')+e;return t.substring(e,s)}}class _{constructor(t){const e=this.parseString(t);this.top1Name=e[1],this.top1Level=+e[2],this.top2Name=e[3],this.top2Level=+e[4],this.top3Name=e[5],this.top3Level=+e[6]}parseString(t){return t.split(",")}}class J{constructor(t){this.client=t}parse(t){try{switch(+t.split(",")[0]){case c.Login:this.parseLogin(t);break;case c.Move:this.parseMove(t);break;case c.NpcsInRoom:this.parseNpcsInRoom(t);break;case c.NpcMove:this.parseNpcMove(t);break;case c.Pve:this.parsePve(t);break;case c.ItemsInRoom:this.parseItemsInRoom(t);break;case c.ItemDrop:this.parseItemDrop(t);break;case c.ItemPick:this.parseItemPick(t);break;case c.ItemUse:this.parseItemUse(t);break;case c.ItemWear:this.parseItemWear(t);break;case c.ItemRemove:this.parseItemRemove(t);break;case c.ItemDroped:this.parseItemDroped(t);break;case c.Stats:this.parseStats(t);break;case c.Rank:this.parseRank(t);break;case c.Message:this.parseMessage(t);break;case c.Error:this.parseError(t)}}catch(t){console.log(t)}}parseLogin(t){const e=new R(t);if(this.client.game.spritesLayer.addPlayers(e.players),!1===this.client.loggedIn){this.client.loggedIn=!0,this.client.playerId=e.playerId,this.client.bag.playerId=e.playerId,this.client.gear.playerId=e.playerId,this.client.game.applyServerRules(e.serverRules);const t=e.players.find(t=>t.id==e.playerId);this.client.applyStats(t.hp,t.maxHp,t.atk,t.def,1,0,t.xpNeed)}this.client.drawSprites()}parseMove(t){const e=new M(t);this.client.updatePlayer(e)}parseNpcMove(t){const e=new H(t);this.client.updateNpc(e)}parseNpcsInRoom(t){const e=new W(t);this.client.game.spritesLayer.addNpcs(e.npcs),this.client.drawSprites()}parsePve(t){const e=new N(t);this.client.drawPve(e)}parseError(t){const e=new z(t);confirm(e.message)||window.location.reload()}parseItemsInRoom(t){const e=new Y(t);this.client.game.spritesLayer.addItems(e.items)}parseItemDrop(t){const e=new O(t);this.client.game.spritesLayer.addItem(e)}parseItemDroped(t){const e=new X(t);this.client.bag.removeItem(e.itemId)}parseItemPick(t){const e=new T(t);this.client.pickItem(e)}parseItemUse(t){const e=new A(t);this.client.bag.removeItem(e.itemId)}parseItemWear(t){const e=new U(t);this.client.bag.removeItem(e.itemId),this.client.gear.addGear(e.itemId,e.gearType)}parseItemRemove(t){const e=new j(t);this.client.removedGear(e),this.client.gear.removeGear(e.itemId)}parseStats(t){const e=new K(t);this.client.applyStats(e.hp,e.maxHp,e.attack,e.defense,e.level,e.xp,e.xpNeeded)}parseRank(t){const e=new _(t);this.client.updateRank(e)}parseMessage(t){const e=new V(t);this.client.displayMessage(e.message)}}class q{constructor(t){this.width=32,this.height=32,this.boardRows=1,this.boardColumns=1,this.canvasId=t,this.c=document.getElementById(t),this.ctx=this.c.getContext("2d"),this.ctx.canvas.width=this.width,this.ctx.canvas.height=this.height,this.boardRows=1,this.boardColumns=1,this.ctx.canvas.width=this.width,this.ctx.canvas.height=this.height,this.cellWidth=this.width/this.boardRows,this.cellHeight=this.height/this.boardColumns,this.c.oncontextmenu=t=>!1}}class Q{constructor(t,e,s,a){this.tileSize=8,this.bag=t,this.itemId=e,this.item=s,this.layer=new q(a)}draw(){this.layer.ctx.beginPath();for(let t=0;t<this.tileSize;t++)for(let e=0;e<this.tileSize;e++){const s=this.item[e][t];if(0!==s){this.layer.ctx.fillStyle=s;const a=t*this.layer.cellWidth/this.tileSize|0,r=e*this.layer.cellHeight/this.tileSize|0,i=this.layer.cellWidth/this.tileSize,l=this.layer.cellHeight/this.tileSize;this.layer.ctx.fillRect(a,r,i,l)}}this.layer.ctx.fill()}destroy(){this.layer=null,this.itemId=null,this.draw=null}}class Z{constructor(t){this.items=[],this.coins=0,this.size=24,this.playerId="",this.itemsCount=0,this.itemsHolderEl=document.getElementById("items"),this.coinsEl=document.getElementById("coins"),this.client=t}drawItems(){for(const t of this.items)t.draw()}addGold(t){this.coins+=t,this.coinsEl.innerHTML="Gold: "+this.coins}addItem(t,e,s){if(this.playerId==s)if(t==d.Coin)this.addGold(e);else if(this.items.length<this.size){this.itemsCount++;const e=this.getItemSprite(t),s=this.addCanvasNode(t);this.items.push(new Q(this,t,e,s)),this.drawItems()}}clickItem(t,e){"mouseup"===t.type?"mouseup"===t.type?0==t.button?this.client.useItem(e):2==t.button&&this.client.dropItem(e):this.client.useItem(e):"touchmove"===t.type&&this.client.dropItem(e)}removeItem(t){if(t!=d.Empty){const e=this.items.map(t=>t.itemId).indexOf(t),s=this.items[e].layer.canvasId;e>-1&&this.items.splice(e,1);const a=document.getElementById(s);this.itemsHolderEl.removeChild(a)}}getItemSprite(t){let e=d[t];return w[e]}addCanvasNode(t){let e=`${t}-${this.itemsCount}`,s=document.createElement("canvas");return s.classList.add("item-btn"),s.id=e,s.onmouseup=e=>this.clickItem(e,t),s.ontouchstart=e=>this.clickItem(e,t),s.ontouchmove=e=>this.clickItem(e,t),s.oncontextmenu=()=>!1,this.itemsHolderEl.appendChild(s),e}}class tt{constructor(t){this.width=32,this.height=32,this.boardRows=1,this.boardColumns=1,this.canvasId=t,this.c=document.getElementById(t),this.ctx=this.c.getContext("2d"),this.ctx.canvas.width=this.width,this.ctx.canvas.height=this.height,this.boardRows=1,this.boardColumns=1,this.ctx.canvas.width=this.width,this.ctx.canvas.height=this.height,this.cellWidth=this.width/this.boardRows,this.cellHeight=this.height/this.boardColumns,this.c.oncontextmenu=t=>!1}}class et{constructor(t,e,s,a){this.tileSize=8,this.gear=t,this.itemId=e,this.item=s,this.layer=new tt(a)}draw(){this.layer.ctx.beginPath();for(let t=0;t<this.tileSize;t++)for(let e=0;e<this.tileSize;e++){const s=this.item[e][t];if(0!==s){this.layer.ctx.fillStyle=s;const a=t*this.layer.cellWidth/this.tileSize|0,r=e*this.layer.cellHeight/this.tileSize|0,i=this.layer.cellWidth/this.tileSize,l=this.layer.cellHeight/this.tileSize;this.layer.ctx.fillRect(a,r,i,l)}}this.layer.ctx.fill()}clear(){this.layer.ctx.clearRect(0,0,this.layer.cellWidth,this.layer.cellHeight)}changeGear(t,e){this.clear(),this.itemId=t,this.item=e}destroy(){this.layer=null,this.itemId=null,this.draw=null}}class st{constructor(t){this.playerId="",this.head=new et(this,d.Empty,w.Empty,"head"),this.torso=new et(this,d.Empty,w.Empty,"torso"),this.legs=new et(this,d.Empty,w.Empty,"legs"),this.weapon=new et(this,d.Empty,w.Empty,"weapon"),this.head.layer.c.onmousedown=t=>this.clickItem(t,this.head),this.torso.layer.c.onmousedown=t=>this.clickItem(t,this.torso),this.legs.layer.c.onmousedown=t=>this.clickItem(t,this.legs),this.weapon.layer.c.onmousedown=t=>this.clickItem(t,this.weapon),this.head.layer.c.ontouchstart=t=>this.clickItem(t,this.head),this.torso.layer.c.ontouchstart=t=>this.clickItem(t,this.torso),this.legs.layer.c.ontouchstart=t=>this.clickItem(t,this.legs),this.weapon.layer.c.ontouchstart=t=>this.clickItem(t,this.weapon),this.head.layer.c.oncontextmenu=()=>!1,this.torso.layer.c.oncontextmenu=()=>!1,this.legs.layer.c.oncontextmenu=()=>!1,this.weapon.layer.c.oncontextmenu=()=>!1,this.client=t,this.drawGear()}drawGear(){this.head.draw(),this.torso.draw(),this.legs.draw(),this.weapon.draw()}addGear(t,e){switch(e){case m.Head:this.head.itemId==d.Empty&&this.head.changeGear(t,this.getItemSprite(t));break;case m.Torso:this.torso.itemId==d.Empty&&this.torso.changeGear(t,this.getItemSprite(t));break;case m.Legs:this.legs.itemId==d.Empty&&this.legs.changeGear(t,this.getItemSprite(t));break;case m.Weapon:this.weapon.itemId==d.Empty&&this.weapon.changeGear(t,this.getItemSprite(t))}this.drawGear()}clickItem(t,e){e.itemId!=d.Empty&&("mousedown"!==t.type&&"touchstart"!==t.type&&"touchmove"!==t.type||("mousedown"===t.type?0==t.button&&this.client.removeGear(e.itemId):this.client.removeGear(e.itemId)))}removeGear(t){this.head.itemId==t&&this.head.changeGear(d.Empty,this.getItemSprite(d.Empty)),this.torso.itemId==t&&this.torso.changeGear(d.Empty,this.getItemSprite(d.Empty)),this.legs.itemId==t&&this.legs.changeGear(d.Empty,this.getItemSprite(d.Empty)),this.weapon.itemId==t&&this.weapon.changeGear(d.Empty,this.getItemSprite(d.Empty)),this.drawGear()}getItemSprite(t){let e=d[t];return w[e]}}class at{constructor(t,e,s){document.onkeydown=this.checkKey.bind(this),this.loginScreen=s.loginScreen,this.gameScreen=s.gameScreen,this.bagElement=s.bagElement,this.coinsElement=s.coinsElement,this.gearElement=s.gearElement,this.hpTextElement=s.hpTextElement,this.xpTextElement=s.xpTextElement,this.hpBarElement=s.hpBarElement,this.xpBarElement=s.xpBarElement,this.atkTextElement=s.atkTextElement,this.defTextElement=s.defTextElement,this.messageElement=s.messageElement,this.rankElement=s.rankElement,this.playersElement=s.playersElement,this.top1Element=s.top1Element,this.top2Element=s.top2Element,this.top3Element=s.top3Element,this.isShowingMessage=!1,this.up=s.mobileUp,this.up.onclick=()=>{this.checkKey({keyCode:38})},this.down=s.mobileDown,this.down.onclick=()=>{this.checkKey({keyCode:40})},this.left=s.mobileLeft,this.left.onclick=()=>{this.checkKey({keyCode:37})},this.right=s.mobileRight,this.right.onclick=()=>{this.checkKey({keyCode:39})},this.isShowingRank=!1,this.showRankBtn=s.showRankBtn,this.showRankBtn.onclick=()=>{this.toggleRank()},this.isShowingPlayerList=!1,this.showPlayersBtn=s.showPlayersBtn,this.showPlayersBtn.onclick=()=>{this.togglePlayers()},this.game=t,this.ws=null,this.loggedIn=!1,this.playerName=e.playerName,this.playerId="",this.bag=new Z(this),this.gear=new st(this),this.currentRoomId=G.Initial,this.playerMatrix=e.playerMatrix,this.parser=new J(this),this.currentRoom=this.game.map.rooms[0],this.canMove=!0,this.setupWebSocket()}setupWebSocket(){let t="wss";"https:"!==location.protocol&&(t="ws"),this.ws=new WebSocket(`${t}://${window.location.host}/ws`),this.initWebSocket()}initWebSocket(){this.ws.onopen=()=>this.successfulConection(),this.ws.addEventListener("message",this.onReceiveMessage.bind(this)),window.onbeforeunload=()=>{this.ws.close()}}successfulConection(){this.ws.send(this.getPlayerLoginData()),this.gameScreen.style.display="block",this.bagElement.style.display="block",this.coinsElement.style.display="block",this.gearElement.style.display="block",this.hpTextElement.style.display="block",this.xpTextElement.style.display="block",this.loginScreen.style.display="none",this.pingPong()}getPlayerLoginData(){let t=JSON.stringify(this.playerMatrix);return c.Login+","+this.playerName+","+this.getRandomPlayerColor()+","+t}onReceiveMessage(t){const e=t.data;this.parser.parse(e)}updatePlayer(t){for(const e of this.game.spritesLayer.players)e.id==t.playerId&&(this.playerId==t.playerId&&t.currentRoomId!=this.currentRoomId&&(this.drawRoom(t.currentRoomId),this.currentRoomId=t.currentRoomId),e.move(t.x,t.y,t.currentRoomId));this.drawSprites()}updateNpc(t){const e=this.game.spritesLayer.getNpcByIdAndRoom(t.id,t.roomId);e.move(t),e.isFighting||this.drawSprites()}drawRoom(t){this.currentRoom.clear(),this.currentRoom=this.game.map.getRoomById(t),this.currentRoom.draw()}drawSprites(){this.game.spritesLayer.draw(this.currentRoomId)}checkKey(t){if(this.canMove){this.delayMove();let e=0;38==t.keyCode||87==t.keyCode?e=o.Up:40==t.keyCode||83==t.keyCode?e=o.Down:37==t.keyCode||65==t.keyCode?e=o.Left:39!=t.keyCode&&68!=t.keyCode||(e=o.Right);const s=this.game.spritesLayer.getPlayerById(this.playerId).isValidMove(e,this.currentRoom.solidLayerShape);this.loggedIn&&s&&this.ws.send(`${c.Move},${e}`)}}delayMove(){this.canMove=!1,setTimeout(()=>{this.canMove=!0},100)}drawPve(t){if(t.attacker==g.Npc){const e=this.game.spritesLayer.getPlayerById(t.playerId);e.takeDamage(t),this.updateHpElements(e.hp,e.maxHp,t.playerId)}else{this.game.spritesLayer.getNpcByIdAndRoom(t.npcId,t.roomId).takeDamage(t)}this.drawSprites()}applyStats(t,e,s,a,r,i,l){const n=this.game.spritesLayer.getPlayerById(this.playerId);n.hp=t,n.maxHp=e,this.updateHpElements(n.hp,n.maxHp,this.playerId),this.updateStatsElements(s,a,this.playerId),this.updateXpElements(r,i,l,this.playerId)}dropItem(t){this.ws.send(`${c.ItemDrop},${t}`)}useItem(t){this.ws.send(`${c.ItemUse},${t}`)}pickItem(t){this.bag.addItem(t.itemId,t.coins,t.playerId),this.game.spritesLayer.removeItem(t)}removeGear(t){this.ws.send(`${c.ItemRemove},${t}`)}removedGear(t){this.gear.removeGear(t.itemId),this.bag.addItem(t.itemId,0,this.playerId)}updateHpElements(t,e,s){if(this.playerId==s){this.hpTextElement.innerHTML=`HP: ${t}/${e}`;const s=t/e*100;this.hpBarElement.style.width=s+"%"}}updateStatsElements(t,e,s){this.playerId==s&&(this.atkTextElement.innerHTML="atk: "+t,this.defTextElement.innerHTML="def: "+e)}updateXpElements(t,e,s,a){if(this.playerId==a){this.xpTextElement.innerHTML="LVL "+t;const a=e/s*100;this.xpBarElement.style.width=a+"%"}}displayMessage(t){this.isShowingMessage||(this.isShowingMessage=!0,this.messageElement.innerHTML=t,setTimeout(()=>{this.isShowingMessage=!1,this.messageElement.innerHTML=""},5e3))}updateRank(t){const e=0!=t.top1Level?`${t.top1Name}: LVL ${t.top1Level}`:"",s=0!=t.top2Level?`${t.top2Name}: LVL ${t.top2Level}`:"",a=0!=t.top3Level?`${t.top3Name}: LVL ${t.top3Level}`:"";this.top1Element.innerHTML=""+e,this.top2Element.innerHTML=""+s,this.top3Element.innerHTML=""+a}toggleRank(){this.isShowingRank?(this.isShowingRank=!1,this.showRankBtn.value="show rank",this.rankElement.style.display="none"):(this.isShowingRank=!0,this.showRankBtn.value="hide rank",this.rankElement.style.display="block")}togglePlayers(){this.isShowingPlayerList?(this.isShowingPlayerList=!1,this.showPlayersBtn.value="show players",this.playersElement.style.display="none"):(this.isShowingPlayerList=!0,this.showPlayersBtn.value="hide players",this.playersElement.style.display="block")}getRandomPlayerColor(){return h[Math.floor(Math.random()*h.length)]}pingPong(){this.ws.send(""+c.Ping),setTimeout(()=>{this.pingPong()},2e4)}}const rt={game:{width:512,height:512},drawingGrid:new i.GridConfig({width:160,height:160,rows:8,columns:8})};new class{constructor(t){this.loginScreen=document.getElementById("login"),this.resetCanvasBtn=document.getElementById("help-draw-mobile"),this.mobileControls=document.getElementById("mobile-controls"),this.playerNameInput=document.getElementById("player-name"),this.confirmBtn=document.getElementById("confirm-btn"),this.mobileUp=document.getElementById("up"),this.mobileDown=document.getElementById("down"),this.mobileLeft=document.getElementById("left"),this.mobileRight=document.getElementById("right"),this.gameScreen=document.getElementById("game"),this.bagElement=document.getElementById("bag"),this.gearElement=document.getElementById("gear"),this.coinsElement=document.getElementById("coins"),this.hpTextElement=document.getElementById("hp-text"),this.xpTextElement=document.getElementById("xp-text"),this.hpBarElement=document.getElementById("hp-bar"),this.xpBarElement=document.getElementById("xp-bar"),this.atkTextElement=document.getElementById("atk-text"),this.defTextElement=document.getElementById("def-text"),this.layersParentElement=document.getElementById("layers"),this.messageElement=document.getElementById("message"),this.showRankBtn=document.getElementById("show-rank"),this.showPlayersBtn=document.getElementById("show-players"),this.rankElement=document.getElementById("game-rank"),this.playersElement=document.getElementById("game-info"),this.top1Element=document.getElementById("top1"),this.top2Element=document.getElementById("top2"),this.top3Element=document.getElementById("top3"),this.gameScreen.style.display="none",this.bagElement.style.display="none",this.coinsElement.style.display="none",this.gearElement.style.display="none",this.hpTextElement.style.display="none",this.xpTextElement.style.display="none",this.isMobile()&&(this.setupMobile(),t.game.width=t.game.width/2,t.game.height=t.game.height/2),this.layersParentElement.style.width=t.game.width+"px",this.layersParentElement.style.height=t.game.height+"px",this.drawingGrid=new a(t.drawingGrid),this.playerConfig={playerName:"",playerMatrix:[]},this.gameConfig=t.game,this.game=null,this.client=null,this.hasConfirmedName=!1,this.confirmBtn.onclick=()=>{this.onConfirmName()},this.resetCanvasBtn.onclick=()=>{this.drawingGrid.reset()}}setupMobile(){document.body.addEventListener("touchmove",t=>{t.preventDefault()},{passive:!1});document.getElementById("help-draw-desktop").style.display="none",this.resetCanvasBtn.style.display="block",this.layersParentElement.style.width=window.screen.width+"px"}onConfirmName(){if(!this.hasConfirmedName&&this.playerNameInput.value){this.playerConfig.playerName=this.playerNameInput.value;if(this.drawingGrid.drawingMatrix.some(t=>t.some(t=>1===t))){if(this.hasConfirmedName=!0,this.playerConfig.playerMatrix=this.drawingGrid.drawingMatrix.map(t=>t.slice()),this.isMobile()){const t=document.getElementById("title"),e=document.getElementById("sub-title");t.style.fontSize="1em",e.style.fontSize="50%"}this.startGame()}}}startGame(){this.game=new P(this.gameConfig,this),this.client=new at(this.game,this.playerConfig,this)}isMobile(){return[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/BlackBerry/i,/Windows Phone/i].some(t=>navigator.userAgent.match(t))}}(rt)}]);