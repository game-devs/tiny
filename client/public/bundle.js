!function(e){var t={};function s(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=e,s.c=t,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)s.d(r,a,function(t){return e[t]}.bind(null,a));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/public",s(s.s=3)}([function(e,t,s){"use strict";var r=s(1);s.d(t,"GridConfig",(function(){return r.a}));s(2)},function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));class r{constructor(e){this.width=0,this.height=0,this.rows=0,this.columns=0,Object.assign(this,e)}get cellWidth(){return this.width/this.rows}get cellHeight(){return this.height/this.columns}}},function(e,t){},function(e,t,s){"use strict";s.r(t);class r{constructor(e){this.config=e;const t=document.getElementById("draw");t.onmousemove=this.mouseMove.bind(this),t.onmousedown=this.mouseClick.bind(this),t.onmouseup=this.mouseClick.bind(this),t.ontouchmove=this.mouseMove.bind(this),t.ontouchstart=this.mouseClick.bind(this),t.ontouchend=this.mouseClick.bind(this),t.oncontextmenu=()=>!1,this.ctx=t.getContext("2d"),this.ctx.canvas.width=e.width,this.ctx.canvas.height=e.height,this.drawing=!1,this.erasing=!1,this.drawGrid(),this.drawingMatrix=this.getInitDrawingMatrix()}mouseMove(e){e=e||window.event;let t=this.getOffset(e);(this.drawing||this.erasing)&&this.draw(t.x,t.y)}mouseClick(e){e=e||window.event;let t=this.getOffset(e);"mousedown"===e.type||"touchstart"===e.type||"touchmove"===e.type?("mousedown"===e.type?0==e.button?(this.drawing=!0,this.erasing=!1):2==e.button&&(this.erasing=!0,this.drawing=!1):(this.drawing=!0,this.erasing=!1),this.draw(t.x,t.y)):(this.drawing=!1,this.erasing=!1)}getOffset(e){let t=0,s=0;e instanceof TouchEvent?e.touches.length>0&&(t=e.touches[0].clientX,s=e.touches[0].clientY):(t=e.clientX,s=e.clientY);const r=(e.target||e.srcElement).getBoundingClientRect();return{x:0|t-r.left,y:0|s-r.top}}draw(e,t){e=Math.floor(e/this.config.cellWidth),t=Math.floor(t/this.config.cellHeight);let s="black",r=1;this.erasing&&(s="white",r=0),this.ctx.beginPath(),this.ctx.rect(e*this.config.cellWidth,t*this.config.cellHeight,this.config.cellWidth,this.config.cellHeight),this.ctx.fillStyle=s,this.ctx.fill(),this.ctx.stroke(),this.drawingMatrix[t][e]=r}drawGrid(){for(let e=0;e<this.config.rows;e++)for(let t=0;t<this.config.columns;t++)this.ctx.beginPath(),this.ctx.rect(e*this.config.cellWidth,t*this.config.cellHeight,this.config.cellWidth,this.config.cellHeight),this.ctx.stroke()}reset(){this.drawingMatrix.length=0,this.ctx.clearRect(0,0,this.config.width,this.config.height),this.drawGrid(),this.drawingMatrix=this.getInitDrawingMatrix()}getInitDrawingMatrix(){let e=[];for(let t=0;t<this.config.rows;t++){e.push([]);for(let s=0;s<this.config.columns;s++)e[t][s]=0}return e}}var a,i=s(0);class l{constructor(e){this.game=e;const t=document.getElementById("background-layer");this.ctx=t.getContext("2d"),this.ctx.shadowOffsetX=0,this.ctx.shadowOffsetY=0,this.ctx.shadowBlur=0,this.ctx.shadowColor="",this.ctx.canvas.width=this.game.gridConfig.width,this.ctx.canvas.height=this.game.gridConfig.height}clear(){this.ctx.clearRect(0,0,this.game.gridConfig.width,this.game.gridConfig.height)}}class h{constructor(e){this.game=e;const t=document.getElementById("solid-layer");this.ctx=t.getContext("2d"),this.ctx.shadowOffsetX=0,this.ctx.shadowOffsetY=0,this.ctx.shadowBlur=0,this.ctx.shadowColor="",this.ctx.canvas.width=this.game.gridConfig.width,this.ctx.canvas.height=this.game.gridConfig.height}clear(){this.ctx.clearRect(0,0,this.game.gridConfig.width,this.game.gridConfig.height)}}!function(e){e.Black="#000000",e.DarkBlue="#1D2B53",e.DarkPurple="#7E2553",e.DarkGreen="#008751",e.Brown="#AB5236",e.DarkGrey="#5F574F",e.LightGrey="#C2C3C7",e.White="#FFF1E8",e.Red="#FF004D",e.Orange="#FFA300",e.Yellow="#FFEC27",e.Green="#00E436",e.Blue="#29ADFF",e.Lavender="#83769C",e.Pink="#FF77A8",e.LightPeach="#FFCCAA"}(a||(a={}));const n=[a.Black,a.DarkBlue,a.DarkGrey,a.DarkPurple,a.Yellow,a.Red];var o,G,c,g,d,m;!function(e){e[e.Up=1]="Up",e[e.Down=2]="Down",e[e.Left=3]="Left",e[e.Right=4]="Right"}(o||(o={})),function(e){e[e.Login=1]="Login",e[e.Move=2]="Move",e[e.Ping=3]="Ping",e[e.Pong=4]="Pong",e[e.Error=5]="Error",e[e.NpcMove=6]="NpcMove",e[e.NpcsInRoom=7]="NpcsInRoom",e[e.Pve=8]="Pve",e[e.ItemsInRoom=9]="ItemsInRoom",e[e.ItemPick=10]="ItemPick",e[e.ItemDrop=11]="ItemDrop",e[e.ItemUse=12]="ItemUse",e[e.ItemWear=13]="ItemWear",e[e.ItemRemove=14]="ItemRemove",e[e.ItemDroped=15]="ItemDroped",e[e.Stats=16]="Stats",e[e.Message=17]="Message"}(G||(G={})),function(e){e[e.Initial=0]="Initial",e[e.Woods=1]="Woods"}(c||(c={})),function(e){e[e.Player=0]="Player",e[e.Npc=1]="Npc"}(g||(g={})),function(e){e[e.Empty=0]="Empty",e[e.Coffee=1]="Coffee",e[e.Coin=2]="Coin",e[e.BronzeDagger=3]="BronzeDagger"}(d||(d={})),function(e){e[e.None=0]="None",e[e.Head=1]="Head",e[e.Torso=2]="Torso",e[e.Legs=3]="Legs",e[e.Weapon=4]="Weapon"}(m||(m={}));class y{constructor(e,t,s){this.game=e,this.layer=s,this.x=t.x,this.y=t.y,this.color=t.color,this.name=t.name,this.id=t.id,this.currentRoomId=t.currentRoomId,this.hp=t.hp,this.maxHp=t.maxHp,this.pveData=t.pveData,this.isFighting=!1,this.playerSize=8,this.matrix=[...t.matrix]}draw(){this.layer.ctx.beginPath(),this.layer.ctx.fillStyle=this.color;for(let e=0;e<this.playerSize;e++)for(let t=0;t<this.playerSize;t++){if(0!=this.matrix[t][e]){const s=e*this.game.gridConfig.cellWidth/this.playerSize+this.x*this.game.gridConfig.cellWidth|0,r=t*this.game.gridConfig.cellHeight/this.playerSize+this.y*this.game.gridConfig.cellHeight|0,a=this.game.gridConfig.cellWidth/this.playerSize,i=this.game.gridConfig.cellHeight/this.playerSize;this.layer.ctx.fillRect(s,r,a,i)}}this.layer.ctx.fill()}takeDamage(e){this.pveData=e,this.hp=e.playerHp,this.isFighting=!0,this.drawHp(),this.hp<=0&&(this.hp=this.maxHp,this.isFighting=!1)}drawHp(){this.layer.ctx.beginPath(),this.layer.ctx.fillStyle=a.Red,this.layer.ctx.fillRect(this.x*this.game.gridConfig.cellWidth,this.y*this.game.gridConfig.cellHeight-7,this.game.gridConfig.cellWidth,5),this.layer.ctx.fillStyle=a.DarkGreen,this.layer.ctx.fillRect(this.x*this.game.gridConfig.cellWidth,this.y*this.game.gridConfig.cellHeight-7,this.game.gridConfig.cellWidth*this.hp/this.maxHp,5),this.layer.ctx.fill(),this.drawHit()}drawHit(){let e="";this.layer.ctx.font="15px arial",this.layer.ctx.textAlign="center",0==this.pveData.damageCaused?this.layer.ctx.fillStyle=a.Blue:(this.layer.ctx.fillStyle=a.Red,e="-");const t=this.x*this.game.gridConfig.cellWidth+this.game.gridConfig.cellWidth/2,s=this.y*this.game.gridConfig.cellHeight-10;this.layer.ctx.fillText(`${e}${this.pveData.damageCaused}`,t,s)}move(e,t,s){e==this.x&&t==this.y||(this.isFighting=!1),this.x=e,this.y=t,this.currentRoomId=s}isValidMove(e,t){let s=!0;switch(e){case o.Up:this.isOnBorder(t,+this.x,+this.y-1)||t[+this.y-1][+this.x]&&(s=!1);break;case o.Down:this.isOnBorder(t,+this.x,+this.y+1)||t[+this.y+1][+this.x]&&(s=!1);break;case o.Left:this.isOnBorder(t,+this.x-1,+this.y)||t[+this.y][+this.x-1]&&(s=!1);break;case o.Right:this.isOnBorder(t,+this.x+1,+this.y)||t[+this.y][+this.x+1]&&(s=!1)}return s}isOnBorder(e,t,s){let r=!1;return void 0!==e[s]?void 0===e[s][t]&&(r=!0):r=!0,r}}class p{constructor(e,t,s,r){this.game=e,this.layer=t,this.id=s.id,this.roomId=s.roomId,this.x=s.x,this.y=s.y,this.tileSize=8,this.tileMatrix=[...r],this.maxHp=s.maxHp,this.hp=s.hp,this.isFighting=!1}draw(){this.layer.ctx.beginPath();for(let e=0;e<this.tileSize;e++)for(let t=0;t<this.tileSize;t++){const s=this.tileMatrix[t][e];if(0!==s){this.layer.ctx.fillStyle=s;const r=e*this.game.gridConfig.cellWidth/this.tileSize+this.x*this.game.gridConfig.cellWidth|0,a=t*this.game.gridConfig.cellHeight/this.tileSize+this.y*this.game.gridConfig.cellHeight|0,i=this.game.gridConfig.cellWidth/this.tileSize,l=this.game.gridConfig.cellHeight/this.tileSize;this.layer.ctx.fillRect(r,a,i,l)}}this.layer.ctx.fill()}takeDamage(e){this.pveData=e,this.hp=e.npcHp,this.isFighting=!0,this.drawHp(),this.hp<=0&&(this.hp=this.maxHp,this.isFighting=!1)}drawHp(){this.layer.ctx.beginPath(),this.layer.ctx.fillStyle=a.Red,this.layer.ctx.fillRect(this.x*this.game.gridConfig.cellWidth,this.y*this.game.gridConfig.cellHeight-7,this.game.gridConfig.cellWidth,5),this.layer.ctx.fillStyle=a.DarkGreen,this.layer.ctx.fillRect(this.x*this.game.gridConfig.cellWidth,this.y*this.game.gridConfig.cellHeight-7,this.game.gridConfig.cellWidth*this.hp/this.maxHp,5),this.layer.ctx.fill(),this.drawHit()}drawHit(){let e="";this.layer.ctx.font="15px arial",this.layer.ctx.textAlign="center",0==this.pveData.damageCaused?this.layer.ctx.fillStyle=a.Blue:(this.layer.ctx.fillStyle=a.Red,e="-"),this.layer.ctx.fillText(`${e}${this.pveData.damageCaused}`,this.x*this.game.gridConfig.cellWidth+this.game.gridConfig.cellWidth/2,this.y*this.game.gridConfig.cellHeight-10)}move(e){e.x==this.x&&e.y==this.y||(this.isFighting=!1),this.x=e.x,this.y=e.y}clear(){this.layer.ctx.clearRect(this.x*this.game.gridConfig.cellWidth,this.y*this.game.gridConfig.cellHeight,this.game.gridConfig.cellWidth,this.game.gridConfig.cellHeight)}destroy(){this.clear(),this.layer=null,this.id=0,this.x=0,this.y=0}}const F={Dog:[[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[a.Brown,0,0,0,0,a.Brown,0,a.Brown],[a.Brown,0,0,0,0,a.Brown,a.Brown,a.Brown],[0,a.Brown,a.Brown,a.Brown,a.Brown,a.Brown,a.Brown,a.Brown],[0,a.Brown,a.Brown,a.Brown,a.Brown,a.Brown,0,0],[0,a.Brown,0,0,0,a.Brown,0,0],[0,a.Brown,0,0,0,a.Brown,0,0]],Spider:[[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,a.DarkGrey,a.DarkGrey,a.DarkGrey,a.DarkGrey,0,0],[0,a.DarkGrey,a.DarkGrey,a.DarkGrey,a.DarkGrey,a.DarkGrey,a.DarkGrey,0],[0,a.DarkGrey,a.DarkPurple,a.DarkGrey,a.DarkGrey,a.DarkPurple,a.DarkGrey,0],[a.DarkGrey,a.DarkGrey,a.DarkGrey,a.DarkGrey,a.DarkGrey,a.DarkGrey,a.DarkGrey,a.DarkGrey],[a.DarkGrey,0,a.DarkGrey,0,0,a.DarkGrey,0,a.DarkGrey],[a.DarkGrey,0,a.DarkGrey,0,0,a.DarkGrey,0,a.DarkGrey]]};class u{constructor(e,t,s,r){this.game=e,this.layer=t,this.id=s.id,this.itemId=s.itemId,this.roomId=s.roomId,this.x=s.x,this.y=s.y,this.tileSize=8,this.itemMatrix=[...r]}draw(){this.layer.ctx.beginPath();for(let e=0;e<this.tileSize;e++)for(let t=0;t<this.tileSize;t++){const s=this.itemMatrix[t][e];if(0!==s){this.layer.ctx.fillStyle=s;const r=e*this.game.gridConfig.cellWidth/this.tileSize+this.x*this.game.gridConfig.cellWidth|0,a=t*this.game.gridConfig.cellHeight/this.tileSize+this.y*this.game.gridConfig.cellHeight|0,i=this.game.gridConfig.cellWidth/this.tileSize,l=this.game.gridConfig.cellHeight/this.tileSize;this.layer.ctx.fillRect(r,a,i,l)}}this.layer.ctx.fill()}clear(){this.layer.ctx.clearRect(this.x*this.game.gridConfig.cellWidth,this.y*this.game.gridConfig.cellHeight,this.game.gridConfig.cellWidth,this.game.gridConfig.cellHeight)}destroy(){this.clear(),this.layer=null,this.id=0,this.x=0,this.y=0}}const w={Empty:[[a.LightGrey,a.LightGrey,a.LightGrey,a.LightGrey,a.LightGrey,a.LightGrey,a.LightGrey,a.LightGrey],[a.LightGrey,0,0,0,0,0,0,a.LightGrey],[a.LightGrey,0,0,0,0,0,0,a.LightGrey],[a.LightGrey,0,0,0,0,0,0,a.LightGrey],[a.LightGrey,0,0,0,0,0,0,a.LightGrey],[a.LightGrey,0,0,0,0,0,0,a.LightGrey],[a.LightGrey,0,0,0,0,0,0,a.LightGrey],[a.LightGrey,a.LightGrey,a.LightGrey,a.LightGrey,a.LightGrey,a.LightGrey,a.LightGrey,a.LightGrey]],Coffee:[[0,0,0,0,a.LightGrey,a.LightGrey,a.LightGrey,0],[0,0,0,0,a.LightGrey,a.LightGrey,0,0],[0,0,0,a.LightGrey,a.LightGrey,0,0,0],[0,0,a.DarkGrey,a.DarkGrey,a.DarkGrey,a.DarkGrey,a.DarkGrey,a.DarkGrey],[0,0,a.DarkGrey,a.DarkGrey,a.DarkGrey,a.DarkGrey,0,a.DarkGrey],[0,0,a.DarkGrey,a.DarkGrey,a.DarkGrey,a.DarkGrey,0,a.DarkGrey],[0,0,a.DarkGrey,a.DarkGrey,a.DarkGrey,a.DarkGrey,a.DarkGrey,a.DarkGrey],[0,0,a.DarkGrey,a.DarkGrey,a.DarkGrey,a.DarkGrey,0,0]],Coin:[[0,0,0,a.Yellow,a.Yellow,0,0,0],[0,0,a.Yellow,a.Orange,a.Yellow,a.Yellow,0,0],[0,a.Yellow,a.Orange,a.Yellow,a.Yellow,a.Yellow,a.Yellow,0],[0,a.Yellow,a.Orange,a.Yellow,a.Yellow,a.Yellow,a.Yellow,0],[0,a.Yellow,a.Orange,a.Yellow,a.Yellow,a.Yellow,a.Yellow,0],[0,a.Yellow,a.Orange,a.Yellow,a.Yellow,a.Yellow,a.Yellow,0],[0,0,a.Yellow,a.Orange,a.Yellow,a.Yellow,0,0],[0,0,0,a.Yellow,a.Yellow,0,0,0]],BronzeDagger:[[0,0,0,0,0,0,0,0],[0,0,0,0,a.Brown,0,0,0],[0,0,0,a.Brown,a.Brown,0,0,0],[0,0,0,a.Brown,a.Brown,0,0,0],[0,0,0,a.Brown,a.Brown,0,0,0],[0,0,0,a.Brown,a.Brown,0,0,0],[0,0,a.DarkGrey,a.DarkGrey,a.DarkGrey,a.DarkGrey,0,0],[0,0,0,a.Brown,a.Brown,0,0,0]]};class f{constructor(e){this.game=e,this.playerListElement=document.getElementById("player-list");const t=document.getElementById("sprites-layer");this.ctx=t.getContext("2d"),this.ctx.shadowOffsetX=0,this.ctx.shadowOffsetY=0,this.ctx.shadowBlur=0,this.ctx.shadowColor="",this.ctx.canvas.width=this.game.gridConfig.width,this.ctx.canvas.height=this.game.gridConfig.height,this.players=[],this.npcs=[],this.items=[]}draw(e){this.ctx.clearRect(0,0,this.game.gridConfig.width,this.game.gridConfig.height),this.drawItems(e),this.drawPlayers(e),this.drawNpcs(e)}clear(){this.ctx.clearRect(0,0,this.game.gridConfig.width,this.game.gridConfig.height)}addPlayers(e){this.players.splice(0,this.players.length);for(const t of e)this.players.push(new y(this.game,t,this))}addNpcs(e){this.npcs.splice(0,this.npcs.length);for(const t of e)this.npcs.push(new p(this.game,this,t,this.getMatrixNpcById(t.npcId)))}addItems(e){this.items.splice(0,this.items.length);for(const t of e)this.items.push(new u(this.game,this,t,this.getMatrixItemById(t.itemId)))}addItem(e){this.items.push(new u(this.game,this,e,this.getMatrixItemById(e.itemId)))}removeItem(e){const t=this.items.findIndex(t=>t.x==e.x&&t.y==e.y);t>-1&&this.items.splice(t,1)}drawPlayers(e){for(;this.playerListElement.firstChild;)this.playerListElement.removeChild(this.playerListElement.firstChild);this.players.forEach(t=>{const s=document.createElement("li");s.appendChild(document.createTextNode(t.name)),s.style.color=t.color,this.playerListElement.appendChild(s),t.currentRoomId==e&&(t.draw(),t.isFighting&&t.drawHp())})}drawNpcs(e){this.npcs.forEach(t=>{t.roomId==e&&(t.draw(),t.isFighting&&t.drawHp())})}drawItems(e){this.items.forEach(t=>{t.roomId==e&&t.draw()})}getPlayerById(e){return this.players.find(t=>t.id===e)}getNpcByIdAndRoom(e,t){return this.npcs.find(s=>s.id===+e&&s.roomId===+t)}getMatrixNpcById(e){let t=F[Object.keys(F)[e-1]];return t||console.log("No sprite defined"),t}getMatrixItemById(e){let t=d[e];return w[t]}}const k={Tree:[[0,a.DarkGreen,a.DarkGreen,a.DarkGreen,a.DarkGreen,a.DarkGreen,a.DarkGreen,0],[a.DarkGreen,a.DarkGreen,a.DarkGreen,a.DarkGreen,a.DarkGreen,a.DarkGreen,a.DarkGreen,a.DarkGreen],[a.DarkGreen,a.DarkGreen,a.DarkGreen,a.DarkGreen,a.DarkGreen,a.DarkGreen,a.DarkGreen,a.DarkGreen],[a.DarkGreen,a.DarkGreen,a.DarkGreen,a.DarkGreen,a.DarkGreen,a.DarkGreen,a.DarkGreen,a.DarkGreen],[0,a.DarkGreen,a.DarkGreen,a.DarkGreen,a.DarkGreen,a.DarkGreen,a.DarkGreen,0],[0,0,0,a.Brown,a.Brown,0,0,0],[0,0,0,a.Brown,a.Brown,0,0,0],[0,0,0,a.Brown,a.Brown,0,0,0]],SmallTree:[[0,0,a.DarkGreen,a.DarkGreen,a.DarkGreen,a.DarkGreen,0,0],[0,a.DarkGreen,a.DarkGreen,a.DarkGreen,a.DarkGreen,a.DarkGreen,a.DarkGreen,0],[0,a.DarkGreen,a.DarkGreen,a.DarkGreen,a.DarkGreen,a.DarkGreen,a.DarkGreen,0],[0,a.DarkGreen,a.DarkGreen,a.DarkGreen,a.DarkGreen,a.DarkGreen,a.DarkGreen,0],[0,0,a.DarkGreen,a.DarkGreen,a.DarkGreen,a.DarkGreen,0,0],[0,0,0,a.Brown,a.Brown,0,0,0],[0,0,0,a.Brown,a.Brown,0,0,0],[0,0,0,a.Brown,a.Brown,0,0,0]],FlatGrass:[[a.Green,a.Green,a.Green,a.Green,a.Green,a.Green,a.Green,a.Green],[a.Green,a.Green,a.Green,a.Green,a.Green,a.Green,a.Green,a.Green],[a.Green,a.Green,a.Green,a.Green,a.Green,a.Green,a.Green,a.Green],[a.Green,a.Green,a.Green,a.Green,a.Green,a.Green,a.Green,a.Green],[a.Green,a.Green,a.Green,a.Green,a.Green,a.Green,a.Green,a.Green],[a.Green,a.Green,a.Green,a.Green,a.Green,a.Green,a.Green,a.Green],[a.Green,a.Green,a.Green,a.Green,a.Green,a.Green,a.Green,a.Green],[a.Green,a.Green,a.Green,a.Green,a.Green,a.Green,a.Green,a.Green]],Grass:[[a.Green,a.Green,a.Green,a.Green,a.Green,a.Green,a.Green,a.Green],[a.Green,a.Green,a.Green,a.Green,a.Green,a.DarkGreen,a.Green,a.Green],[a.Green,a.Green,a.DarkGreen,a.Green,a.Green,a.Green,a.Green,a.Green],[a.Green,a.Green,a.Green,a.Green,a.Green,a.Green,a.Green,a.Green],[a.Green,a.DarkGreen,a.Green,a.Green,a.Green,a.Green,a.Green,a.Green],[a.Green,a.Green,a.Green,a.Green,a.DarkGreen,a.Green,a.Green,a.Green],[a.Green,a.Green,a.Green,a.Green,a.Green,a.Green,a.Green,a.Green],[a.Green,a.Green,a.Green,a.Green,a.Green,a.Green,a.Green,a.Green]],Bush:[[a.Green,a.Green,a.Green,a.Green,a.Green,a.Green,a.Green,a.Green],[a.Green,a.Green,a.Green,a.Green,a.Green,a.Green,a.Green,a.Green],[a.Green,a.Green,a.Green,a.Green,a.Green,a.Green,a.Green,a.DarkGreen],[a.Green,a.Green,a.DarkGreen,a.Green,a.Green,a.Green,a.DarkGreen,a.Green],[a.Green,a.Green,a.Green,a.DarkGreen,a.Green,a.Green,a.DarkGreen,a.Green],[a.Green,a.Green,a.Green,a.DarkGreen,a.Green,a.DarkGreen,a.Green,a.Green],[a.Green,a.DarkGreen,a.Green,a.Green,a.DarkGreen,a.DarkGreen,a.Green,a.DarkGreen],[a.Green,a.Green,a.DarkGreen,a.Green,a.DarkGreen,a.DarkGreen,a.DarkGreen,a.Green]],Dirt:[[a.Green,a.Green,a.LightPeach,a.LightPeach,a.LightPeach,a.LightPeach,a.Green,a.Green],[a.Green,a.Green,a.LightPeach,a.LightPeach,a.LightPeach,a.LightPeach,a.LightPeach,a.LightPeach],[a.LightPeach,a.LightPeach,a.LightPeach,a.LightPeach,a.LightPeach,a.LightPeach,a.LightPeach,a.LightPeach],[a.LightPeach,a.LightPeach,a.LightPeach,a.LightPeach,a.LightPeach,a.LightPeach,a.LightPeach,a.LightPeach],[a.LightPeach,a.LightPeach,a.LightPeach,a.LightPeach,a.LightPeach,a.LightPeach,a.LightPeach,a.LightPeach],[a.LightPeach,a.LightPeach,a.LightPeach,a.LightPeach,a.LightPeach,a.LightPeach,a.LightPeach,a.LightPeach],[a.Green,a.LightPeach,a.LightPeach,a.LightPeach,a.LightPeach,a.LightPeach,a.LightPeach,a.Green],[a.Green,a.LightPeach,a.LightPeach,a.LightPeach,a.LightPeach,a.LightPeach,a.Green,a.Green]],Rocks:[[a.Green,a.Green,a.Green,a.Green,a.Green,a.Green,a.Green,a.Green],[a.Green,a.Green,a.Green,a.Green,a.Green,a.Green,a.Green,a.Green],[a.Green,a.Green,a.Green,a.Green,a.Green,a.DarkGrey,a.Green,a.Green],[a.Green,a.DarkGrey,a.Green,a.Green,a.Green,a.Green,a.Green,a.Green],[a.Green,a.Green,a.Green,a.Green,a.Green,a.Green,a.Green,a.Green],[a.Green,a.Green,a.DarkGrey,a.Green,a.Green,a.DarkGrey,a.Green,a.Green],[a.Green,a.Green,a.Green,a.Green,a.Green,a.Green,a.Green,a.Green],[a.Green,a.Green,a.Green,a.Green,a.Green,a.Green,a.Green,a.Green]]},x=[[0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,2,1,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,1,0,0,0,0,0,0,0,2,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,2],[0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,2,0,0,0,0,1,0,0,2,0],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1]],I=[[1,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0],[0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,0,0,0,0,0,0,2,0],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0],[0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0],[2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]];class D{constructor(e,t,s,r,a){this.game=e,this.layer=t,this.id=0,this.x=s,this.y=r,this.tileSize=8,this.tileMatrix=a}draw(){this.layer.ctx.beginPath();for(let e=0;e<this.tileSize;e++)for(let t=0;t<this.tileSize;t++){const s=this.tileMatrix[t][e];if(0!==s){this.layer.ctx.fillStyle=s;const r=e*this.game.gridConfig.cellWidth/this.tileSize+this.x*this.game.gridConfig.cellWidth|0,a=t*this.game.gridConfig.cellHeight/this.tileSize+this.y*this.game.gridConfig.cellHeight|0,i=this.game.gridConfig.cellWidth/this.tileSize,l=this.game.gridConfig.cellHeight/this.tileSize;this.layer.ctx.fillRect(r,a,i,l)}}this.layer.ctx.fill()}clear(){this.layer.ctx.clearRect(this.x,this.y,this.game.gridConfig.cellWidth,this.game.gridConfig.cellHeight)}destroy(){this.clear(),this.game=null,this.layer=null,this.id=0,this.x=0,this.y=0}}class C{constructor(e,t,s,r){this.game=e,this.id=t,this.backgroundLayerShape=s,this.solidLayerShape=r,this.tiles=[],this.initTiles()}initTiles(){for(let e=0;e<this.game.gridConfig.columns;e++)for(let t=0;t<this.game.gridConfig.rows;t++){const s=this.backgroundLayerShape[t][e];0!=s&&this.tiles.push(new D(this.game,this.game.backgroundLayer,e,t,s));const r=this.solidLayerShape[t][e];if(0!=r){const s=k[Object.keys(k)[r-1]];this.tiles.push(new D(this.game,this.game.solidLayer,e,t,s))}}}draw(){for(const e of this.tiles)e.draw()}clear(){this.game.backgroundLayer.clear(),this.game.solidLayer.clear()}}const S=[[k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Grass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass],[k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass],[k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Bush,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Grass],[k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Bush,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass],[k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass],[k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Grass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass],[k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Grass,k.FlatGrass,k.FlatGrass],[k.Dirt,k.Dirt,k.Dirt,k.Dirt,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Rocks,k.FlatGrass,k.FlatGrass,k.FlatGrass],[k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Dirt,k.Dirt,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Grass,k.Grass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass],[k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Dirt,k.Dirt,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass],[k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Dirt,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Grass,k.FlatGrass],[k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Dirt,k.Dirt,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass],[k.FlatGrass,k.FlatGrass,k.Grass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Dirt,k.Dirt,k.FlatGrass,k.FlatGrass,k.Grass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass],[k.Bush,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Bush,k.FlatGrass,k.FlatGrass,k.Dirt,k.FlatGrass,k.Grass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass],[k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Dirt,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass],[k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Bush,k.Dirt,k.Dirt,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass]];class L extends C{constructor(e,t){super(e,t,S,I)}}const b=[[k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass],[k.FlatGrass,k.Bush,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass],[k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Grass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Bush,k.FlatGrass,k.FlatGrass,k.Grass,k.FlatGrass],[k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Grass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass],[k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Grass,k.FlatGrass,k.FlatGrass,k.Grass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Bush,k.Rocks,k.FlatGrass,k.FlatGrass],[k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Grass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass],[k.FlatGrass,k.Grass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Grass,k.FlatGrass,k.FlatGrass],[k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Bush,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Dirt,k.Dirt],[k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Rocks,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Rocks,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass],[k.FlatGrass,k.FlatGrass,k.Grass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass],[k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Grass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Bush,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass],[k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass],[k.FlatGrass,k.FlatGrass,k.Bush,k.Grass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.Grass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass],[k.FlatGrass,k.Bush,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass],[k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass],[k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass,k.FlatGrass]];class E extends C{constructor(e,t){super(e,t,b,x)}}class B{constructor(e){this.game=e,this.rooms=this.buildMap()}getRoomById(e){return this.rooms.find(t=>t.id===e)||this.rooms[e]}buildMap(){return[new E(this.game,c.Initial),new L(this.game,c.Woods)]}}class v{constructor(e,t){this.game=e,this.layer=t}draw(){this.layer.clear(),this.layer.ctx.beginPath(),this.layer.ctx.rect(0,0,this.game.gridConfig.width,this.game.gridConfig.height),this.layer.ctx.stroke()}}class P{constructor(e,t){this.gridConfig=new i.GridConfig({width:e.width,height:e.height,rows:16,columns:16}),this.backgroundLayer=new l(this),this.solidLayer=new h(this),this.spritesLayer=new f(this),this.map=new B(this),this.board=new v(this,this.backgroundLayer),t.isMobile()&&(t.mobileControls.style.display="block")}applyServerRules(e){this.gridConfig.rows=e.boardRows,this.gridConfig.columns=e.boardColumns,this.board.draw(),this.map.rooms[c.Initial].draw()}}class R{constructor(e){const t=this.parseString(e);this.playerId=t[1],this.serverRules={boardRows:+t[2],boardColumns:+t[3]},this.players=JSON.parse(t[4])}parseString(e){let t=e,s="";t=e.substr(0,e.indexOf(",[")),s=e.substr(e.indexOf("["),e.length);let r=t.split(",");return r.push(s),r}}class M{constructor(e){const t=this.parseString(e);this.playerId=t[1],this.currentRoomId=+t[4],this.x=+t[2],this.y=+t[3]}parseString(e){return e.split(",")}}class H{constructor(e){const t=this.parseString(e);this.id=+t[1],this.npcId=+t[2],this.x=+t[3],this.y=+t[4],this.roomId=+t[5]}parseString(e){return e.split(",")}}class W{constructor(e){const t=this.parseString(e);this.npcs=JSON.parse(t[1])}parseString(e){let t=e,s="";t=e.substr(0,e.indexOf(",[")),s=e.substr(e.indexOf("["),e.length);let r=t.split(",");return r.push(s),r}}class N{constructor(e){const t=this.parseString(e);this.attacker=t[1],this.damageCaused=+t[2],this.npcHp=+t[3],this.npcId=t[4],this.playerHp=+t[5],this.playerId=t[6],this.roomId=t[7]}parseString(e){return e.split(",")}}class z{constructor(e){const t=this.parseString(e);this.message=t[1]}parseString(e){return e.split(",")}}class O{constructor(e){const t=this.parseString(e);this.playerId=t[1],this.itemId=+t[2],this.coins=+t[3],this.x=+t[4],this.y=+t[5]}parseString(e){return e.split(",")}}class T{constructor(e){const t=this.parseString(e);this.id=+t[1],this.itemId=+t[2],this.roomId=+t[3],this.x=+t[4],this.y=+t[5]}parseString(e){return e.split(",")}}class Y{constructor(e){this.items=this.parseString(e)}parseString(e){let t=[],s="",r=+e.substr(0,e.indexOf(",[")).split(",")[1];s=e.substr(e.indexOf("["),e.length);let a=JSON.parse(s);for(const e of a)t.push(new $(e.id,e.itemId,r,e.x,e.y));return t}}class ${constructor(e,t,s,r,a){this.id=e,this.itemId=t,this.roomId=s,this.x=r,this.y=a}}class A{constructor(e){const t=this.parseString(e);this.itemId=t}parseString(e){return+e.split(",")[1]}}class U{constructor(e){const t=this.parseString(e);this.itemId=+t[1],this.gearType=+t[2]}parseString(e){return e.split(",")}}class j{constructor(e){const t=this.parseString(e);this.itemId=+t[1]}parseString(e){return e.split(",")}}class X{constructor(e){const t=this.parseString(e);this.itemId=+t[1]}parseString(e){return e.split(",")}}class K{constructor(e){const t=this.parseString(e);this.hp=+t[1],this.maxHp=+t[2],this.attack=+t[3],this.defense=+t[4],this.level=+t[5],this.xp=+t[6],this.xpNeeded=+t[7]}parseString(e){return e.split(",")}}class _{constructor(e){const t=this.parseString(e);this.message=t}parseString(e){const t=e.indexOf(',"')+2,s=e.split(',"')[1].indexOf('"')+t;return e.substring(t,s)}}class J{constructor(e){this.client=e}parse(e){try{switch(+e.split(",")[0]){case G.Login:this.parseLogin(e);break;case G.Move:this.parseMove(e);break;case G.NpcsInRoom:this.parseNpcsInRoom(e);break;case G.NpcMove:this.parseNpcMove(e);break;case G.Pve:this.parsePve(e);break;case G.ItemsInRoom:this.parseItemsInRoom(e);break;case G.ItemDrop:this.parseItemDrop(e);break;case G.ItemPick:this.parseItemPick(e);break;case G.ItemUse:this.parseItemUse(e);break;case G.ItemWear:this.parseItemWear(e);break;case G.ItemRemove:this.parseItemRemove(e);break;case G.ItemDroped:this.parseItemDroped(e);break;case G.Stats:this.parseStats(e);break;case G.Message:this.parseMessage(e);break;case G.Error:this.parseError(e)}}catch(e){console.log(e)}}parseLogin(e){const t=new R(e);if(this.client.game.spritesLayer.addPlayers(t.players),!1===this.client.loggedIn){this.client.loggedIn=!0,this.client.playerId=t.playerId,this.client.bag.playerId=t.playerId,this.client.gear.playerId=t.playerId,this.client.game.applyServerRules(t.serverRules);const e=t.players.find(e=>e.id==t.playerId);this.client.applyStats(e.hp,e.maxHp,e.atk,e.def,1,0,e.xpNeed)}this.client.drawSprites()}parseMove(e){const t=new M(e);this.client.updatePlayer(t)}parseNpcMove(e){const t=new H(e);this.client.updateNpc(t)}parseNpcsInRoom(e){const t=new W(e);this.client.game.spritesLayer.addNpcs(t.npcs),this.client.drawSprites()}parsePve(e){const t=new N(e);this.client.drawPve(t)}parseError(e){const t=new z(e);confirm(t.message)||window.location.reload()}parseItemsInRoom(e){const t=new Y(e);this.client.game.spritesLayer.addItems(t.items)}parseItemDrop(e){const t=new T(e);this.client.game.spritesLayer.addItem(t)}parseItemDroped(e){const t=new X(e);this.client.bag.removeItem(t.itemId)}parseItemPick(e){const t=new O(e);this.client.pickItem(t)}parseItemUse(e){const t=new A(e);this.client.bag.removeItem(t.itemId)}parseItemWear(e){const t=new U(e);this.client.bag.removeItem(t.itemId),this.client.gear.addGear(t.itemId,t.gearType)}parseItemRemove(e){const t=new j(e);this.client.removedGear(t),this.client.gear.removeGear(t.itemId)}parseStats(e){const t=new K(e);this.client.applyStats(t.hp,t.maxHp,t.attack,t.defense,t.level,t.xp,t.xpNeeded)}parseMessage(e){const t=new _(e);this.client.displayMessage(t.message)}}class V{constructor(e){this.width=32,this.height=32,this.boardRows=1,this.boardColumns=1,this.canvasId=e,this.c=document.getElementById(e),this.ctx=this.c.getContext("2d"),this.ctx.canvas.width=this.width,this.ctx.canvas.height=this.height,this.boardRows=1,this.boardColumns=1,this.ctx.canvas.width=this.width,this.ctx.canvas.height=this.height,this.cellWidth=this.width/this.boardRows,this.cellHeight=this.height/this.boardColumns,this.c.oncontextmenu=e=>!1}}class q{constructor(e,t,s,r){this.tileSize=8,this.bag=e,this.itemId=t,this.item=s,this.layer=new V(r)}draw(){this.layer.ctx.beginPath();for(let e=0;e<this.tileSize;e++)for(let t=0;t<this.tileSize;t++){const s=this.item[t][e];if(0!==s){this.layer.ctx.fillStyle=s;const r=e*this.layer.cellWidth/this.tileSize|0,a=t*this.layer.cellHeight/this.tileSize|0,i=this.layer.cellWidth/this.tileSize,l=this.layer.cellHeight/this.tileSize;this.layer.ctx.fillRect(r,a,i,l)}}this.layer.ctx.fill()}destroy(){this.layer=null,this.itemId=null,this.draw=null}}class Q{constructor(e){this.items=[],this.coins=0,this.size=24,this.playerId="",this.itemsCount=0,this.itemsHolderEl=document.getElementById("items"),this.coinsEl=document.getElementById("coins"),this.client=e}drawItems(){for(const e of this.items)e.draw()}addGold(e){this.coins+=e,this.coinsEl.innerHTML="Gold: "+this.coins}addItem(e,t,s){if(this.playerId==s)if(e==d.Coin)this.addGold(t);else if(this.items.length<this.size){this.itemsCount++;const t=this.getItemSprite(e),s=this.addCanvasNode(e);this.items.push(new q(this,e,t,s)),this.drawItems()}}clickItem(e,t){"mouseup"===e.type?"mouseup"===e.type?0==e.button?this.client.useItem(t):2==e.button&&this.client.dropItem(t):this.client.useItem(t):"touchmove"===e.type&&this.client.dropItem(t)}removeItem(e){if(e!=d.Empty){const t=this.items.map(e=>e.itemId).indexOf(e),s=this.items[t].layer.canvasId;t>-1&&this.items.splice(t,1);const r=document.getElementById(s);this.itemsHolderEl.removeChild(r)}}getItemSprite(e){let t=d[e];return w[t]}addCanvasNode(e){let t=`${e}-${this.itemsCount}`,s=document.createElement("canvas");return s.classList.add("item-btn"),s.id=t,s.onmouseup=t=>this.clickItem(t,e),s.ontouchstart=t=>this.clickItem(t,e),s.ontouchmove=t=>this.clickItem(t,e),s.oncontextmenu=()=>!1,this.itemsHolderEl.appendChild(s),t}}class Z{constructor(e){this.width=32,this.height=32,this.boardRows=1,this.boardColumns=1,this.canvasId=e,this.c=document.getElementById(e),this.ctx=this.c.getContext("2d"),this.ctx.canvas.width=this.width,this.ctx.canvas.height=this.height,this.boardRows=1,this.boardColumns=1,this.ctx.canvas.width=this.width,this.ctx.canvas.height=this.height,this.cellWidth=this.width/this.boardRows,this.cellHeight=this.height/this.boardColumns,this.c.oncontextmenu=e=>!1}}class ee{constructor(e,t,s,r){this.tileSize=8,this.gear=e,this.itemId=t,this.item=s,this.layer=new Z(r)}draw(){this.layer.ctx.beginPath();for(let e=0;e<this.tileSize;e++)for(let t=0;t<this.tileSize;t++){const s=this.item[t][e];if(0!==s){this.layer.ctx.fillStyle=s;const r=e*this.layer.cellWidth/this.tileSize|0,a=t*this.layer.cellHeight/this.tileSize|0,i=this.layer.cellWidth/this.tileSize,l=this.layer.cellHeight/this.tileSize;this.layer.ctx.fillRect(r,a,i,l)}}this.layer.ctx.fill()}clear(){this.layer.ctx.clearRect(0,0,this.layer.cellWidth,this.layer.cellHeight)}changeGear(e,t){this.clear(),this.itemId=e,this.item=t}destroy(){this.layer=null,this.itemId=null,this.draw=null}}class te{constructor(e){this.playerId="",this.head=new ee(this,d.Empty,w.Empty,"head"),this.torso=new ee(this,d.Empty,w.Empty,"torso"),this.legs=new ee(this,d.Empty,w.Empty,"legs"),this.weapon=new ee(this,d.Empty,w.Empty,"weapon"),this.head.layer.c.onmousedown=e=>this.clickItem(e,this.head),this.torso.layer.c.onmousedown=e=>this.clickItem(e,this.torso),this.legs.layer.c.onmousedown=e=>this.clickItem(e,this.legs),this.weapon.layer.c.onmousedown=e=>this.clickItem(e,this.weapon),this.head.layer.c.ontouchstart=e=>this.clickItem(e,this.head),this.torso.layer.c.ontouchstart=e=>this.clickItem(e,this.torso),this.legs.layer.c.ontouchstart=e=>this.clickItem(e,this.legs),this.weapon.layer.c.ontouchstart=e=>this.clickItem(e,this.weapon),this.head.layer.c.oncontextmenu=()=>!1,this.torso.layer.c.oncontextmenu=()=>!1,this.legs.layer.c.oncontextmenu=()=>!1,this.weapon.layer.c.oncontextmenu=()=>!1,this.client=e,this.drawGear()}drawGear(){this.head.draw(),this.torso.draw(),this.legs.draw(),this.weapon.draw()}addGear(e,t){switch(t){case m.Head:this.head.itemId==d.Empty&&this.head.changeGear(e,this.getItemSprite(e));break;case m.Torso:this.torso.itemId==d.Empty&&this.torso.changeGear(e,this.getItemSprite(e));break;case m.Legs:this.legs.itemId==d.Empty&&this.legs.changeGear(e,this.getItemSprite(e));break;case m.Weapon:this.weapon.itemId==d.Empty&&this.weapon.changeGear(e,this.getItemSprite(e))}this.drawGear()}clickItem(e,t){t.itemId!=d.Empty&&("mousedown"!==e.type&&"touchstart"!==e.type&&"touchmove"!==e.type||("mousedown"===e.type?0==e.button&&this.client.removeGear(t.itemId):this.client.removeGear(t.itemId)))}removeGear(e){this.head.itemId==e&&this.head.changeGear(d.Empty,this.getItemSprite(d.Empty)),this.torso.itemId==e&&this.torso.changeGear(d.Empty,this.getItemSprite(d.Empty)),this.legs.itemId==e&&this.legs.changeGear(d.Empty,this.getItemSprite(d.Empty)),this.weapon.itemId==e&&this.weapon.changeGear(d.Empty,this.getItemSprite(d.Empty)),this.drawGear()}getItemSprite(e){let t=d[e];return w[t]}}class se{constructor(e,t,s){document.onkeydown=this.checkKey.bind(this),this.loginScreen=s.loginScreen,this.gameScreen=s.gameScreen,this.bagElement=s.bagElement,this.coinsElement=s.coinsElement,this.gearElement=s.gearElement,this.hpTextElement=s.hpTextElement,this.xpTextElement=s.xpTextElement,this.hpBarElement=s.hpBarElement,this.xpBarElement=s.xpBarElement,this.atkTextElement=s.atkTextElement,this.defTextElement=s.defTextElement,this.messageElement=s.messageElement,this.isShowingMessage=!1,this.up=s.mobileUp,this.up.onclick=()=>{this.checkKey({keyCode:38})},this.down=s.mobileDown,this.down.onclick=()=>{this.checkKey({keyCode:40})},this.left=s.mobileLeft,this.left.onclick=()=>{this.checkKey({keyCode:37})},this.right=s.mobileRight,this.right.onclick=()=>{this.checkKey({keyCode:39})},this.game=e,this.ws=null,this.loggedIn=!1,this.playerName=t.playerName,this.playerId="",this.bag=new Q(this),this.gear=new te(this),this.currentRoomId=c.Initial,this.playerMatrix=t.playerMatrix,this.parser=new J(this),this.currentRoom=this.game.map.rooms[0],this.canMove=!0,this.setupWebSocket()}setupWebSocket(){let e="wss";"https:"!==location.protocol&&(e="ws"),this.ws=new WebSocket(`${e}://${window.location.host}/ws`),this.initWebSocket()}initWebSocket(){this.ws.onopen=()=>this.successfulConection(),this.ws.addEventListener("message",this.onReceiveMessage.bind(this))}successfulConection(){this.ws.send(this.getPlayerLoginData()),this.gameScreen.style.display="block",this.bagElement.style.display="block",this.coinsElement.style.display="block",this.gearElement.style.display="block",this.hpTextElement.style.display="block",this.xpTextElement.style.display="block",this.loginScreen.style.display="none",this.pingPong()}getPlayerLoginData(){let e=JSON.stringify(this.playerMatrix);return G.Login+","+this.playerName+","+this.getRandomPlayerColor()+","+e}onReceiveMessage(e){const t=e.data;this.parser.parse(t)}updatePlayer(e){for(const t of this.game.spritesLayer.players)t.id==e.playerId&&(this.playerId==e.playerId&&e.currentRoomId!=this.currentRoomId&&(this.drawRoom(e.currentRoomId),this.currentRoomId=e.currentRoomId),t.move(e.x,e.y,e.currentRoomId));this.drawSprites()}updateNpc(e){const t=this.game.spritesLayer.getNpcByIdAndRoom(e.id,e.roomId);t.move(e),t.isFighting||this.drawSprites()}drawRoom(e){this.currentRoom.clear(),this.currentRoom=this.game.map.getRoomById(e),this.currentRoom.draw()}drawSprites(){this.game.spritesLayer.draw(this.currentRoomId)}checkKey(e){if(this.canMove){this.delayMove();let t=0;38==e.keyCode||87==e.keyCode?t=o.Up:40==e.keyCode||83==e.keyCode?t=o.Down:37==e.keyCode||65==e.keyCode?t=o.Left:39!=e.keyCode&&68!=e.keyCode||(t=o.Right);const s=this.game.spritesLayer.getPlayerById(this.playerId).isValidMove(t,this.currentRoom.solidLayerShape);this.loggedIn&&s&&this.ws.send(`${G.Move},${t}`)}}delayMove(){this.canMove=!1,setTimeout(()=>{this.canMove=!0},100)}drawPve(e){if(e.attacker==g.Npc){const t=this.game.spritesLayer.getPlayerById(e.playerId);t.takeDamage(e),this.updateHpElements(t.hp,t.maxHp,e.playerId)}else{this.game.spritesLayer.getNpcByIdAndRoom(e.npcId,e.roomId).takeDamage(e)}this.drawSprites()}applyStats(e,t,s,r,a,i,l){const h=this.game.spritesLayer.getPlayerById(this.playerId);h.hp=e,h.maxHp=t,this.updateHpElements(h.hp,h.maxHp,this.playerId),this.updateStatsElements(s,r,this.playerId),this.updateXpElements(a,i,l,this.playerId)}dropItem(e){this.ws.send(`${G.ItemDrop},${e}`)}useItem(e){this.ws.send(`${G.ItemUse},${e}`)}pickItem(e){this.bag.addItem(e.itemId,e.coins,e.playerId),this.game.spritesLayer.removeItem(e)}removeGear(e){this.ws.send(`${G.ItemRemove},${e}`)}removedGear(e){this.gear.removeGear(e.itemId),this.bag.addItem(e.itemId,0,this.playerId)}updateHpElements(e,t,s){if(this.playerId==s){this.hpTextElement.innerHTML=`HP: ${e}/${t}`;const s=e/t*100;this.hpBarElement.style.width=s+"%"}}updateStatsElements(e,t,s){this.playerId==s&&(this.atkTextElement.innerHTML="atk: "+e,this.defTextElement.innerHTML="def: "+t)}updateXpElements(e,t,s,r){if(this.playerId==r){this.xpTextElement.innerHTML="LVL "+e;const r=t/s*100;this.xpBarElement.style.width=r+"%"}}displayMessage(e){this.isShowingMessage||(this.isShowingMessage=!0,this.messageElement.innerHTML=e,setTimeout(()=>{this.isShowingMessage=!1,this.messageElement.innerHTML=""},5e3))}getRandomPlayerColor(){return n[Math.floor(Math.random()*n.length)]}pingPong(){this.ws.send(""+G.Ping),setTimeout(()=>{this.pingPong()},2e4)}}const re={game:{width:512,height:512},drawingGrid:new i.GridConfig({width:160,height:160,rows:8,columns:8})};new class{constructor(e){this.loginScreen=document.getElementById("login"),this.resetCanvasBtn=document.getElementById("help-draw-mobile"),this.mobileControls=document.getElementById("mobile-controls"),this.playerNameInput=document.getElementById("player-name"),this.confirmBtn=document.getElementById("confirm-btn"),this.mobileUp=document.getElementById("up"),this.mobileDown=document.getElementById("down"),this.mobileLeft=document.getElementById("left"),this.mobileRight=document.getElementById("right"),this.gameScreen=document.getElementById("game"),this.bagElement=document.getElementById("bag"),this.gearElement=document.getElementById("gear"),this.coinsElement=document.getElementById("coins"),this.hpTextElement=document.getElementById("hp-text"),this.xpTextElement=document.getElementById("xp-text"),this.hpBarElement=document.getElementById("hp-bar"),this.xpBarElement=document.getElementById("xp-bar"),this.atkTextElement=document.getElementById("atk-text"),this.defTextElement=document.getElementById("def-text"),this.layersParentElement=document.getElementById("layers"),this.messageElement=document.getElementById("message"),this.gameScreen.style.display="none",this.bagElement.style.display="none",this.coinsElement.style.display="none",this.gearElement.style.display="none",this.hpTextElement.style.display="none",this.xpTextElement.style.display="none",this.isMobile()&&(this.setupMobile(),e.game.width=e.game.width/2,e.game.height=e.game.height/2),this.layersParentElement.style.width=e.game.width+"px",this.layersParentElement.style.height=e.game.height+"px",this.drawingGrid=new r(e.drawingGrid),this.playerConfig={playerName:"",playerMatrix:[]},this.gameConfig=e.game,this.game=null,this.client=null,this.hasConfirmedName=!1,this.confirmBtn.onclick=()=>{this.onConfirmName()},this.resetCanvasBtn.onclick=()=>{this.drawingGrid.reset()}}setupMobile(){document.body.addEventListener("touchmove",e=>{e.preventDefault()},{passive:!1});document.getElementById("help-draw-desktop").style.display="none",this.resetCanvasBtn.style.display="block",this.layersParentElement.style.width=window.screen.width+"px"}onConfirmName(){if(!this.hasConfirmedName&&this.playerNameInput.value){this.playerConfig.playerName=this.playerNameInput.value;if(this.drawingGrid.drawingMatrix.some(e=>e.some(e=>1===e))){if(this.hasConfirmedName=!0,this.playerConfig.playerMatrix=this.drawingGrid.drawingMatrix.map(e=>e.slice()),this.isMobile()){const e=document.getElementById("title"),t=document.getElementById("sub-title");e.style.fontSize="1em",t.style.fontSize="50%"}this.startGame()}}}startGame(){this.game=new P(this.gameConfig,this),this.client=new se(this.game,this.playerConfig,this)}isMobile(){return[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/BlackBerry/i,/Windows Phone/i].some(e=>navigator.userAgent.match(e))}}(re)}]);